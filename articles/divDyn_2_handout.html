<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="divDyn">
<title>Handout • divDyn</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Handout">
<meta property="og:description" content="divDyn">
<meta property="og:image" content="https://divDyn.github.io/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">divDyn</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <a class="dropdown-item" href="../articles/divDyn_1_installation.html">1. Installation</a>
    <a class="dropdown-item" href="../articles/divDyn_2_handout.html">2. Handout</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-internals">Internals</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-internals">
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://www.evolv-ed.net/">How-to guides on EvolvED</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/divDyn/divDyn/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">

<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Handout</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/divDyn/divDyn/blob/HEAD/vignettes/divDyn_2_handout.Rmd" class="external-link"><code>vignettes/divDyn_2_handout.Rmd</code></a></small>
      <div class="d-none name"><code>divDyn_2_handout.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">1. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The purpose of this vignette is to guide users through the basic capabilities of the ‘divDyn’ package. Fossil occurrence databases, such as the Paleobiology Database (PaleoDB, <a href="http://www.paleobiodb.org/" class="external-link uri">http://www.paleobiodb.org/</a>, <a href="http://fossilworks.org" class="external-link uri">http://fossilworks.org</a>) are readily available to be used in analyses of diversity, extinction and origination patterns (the dynamics of biodiversity), with a certain toolkit that has become standard since the creation of the database. Until now, the implementation of most of these tools have been the responsibilities of individual researchers, with no software package to rely on. This R package intends to fill this gap.</p>
<div class="section level3">
<h3 id="installation">1.1. Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<p>To install this beta version of the package, you must download it either from the CRAN servers or its dedicated GitHub repository (<a href="http://www.github.com/divDyn/r_package/" class="external-link uri">http://www.github.com/divDyn/r_package/</a>). All minor updates will be posted on GitHub as soon as they are finished, so please check this regularly. The version on CRAN will be lagging for some time, as it takes the servers many days to process everything and updates are expected to be frequent. All questions should be addressed to Adam Kocsis, the creator and maintainer of the package (<a href="mailto:adam.kocsis@fau.de" class="email">adam.kocsis@fau.de</a>). Instead of spending it on actual research, a tremendous amount of time was invested in making this piece of software useable and user-friendly. If you use a method implemented in the package in a publication, please cite both its reference(s) and the ‘divDyn’ package itself (Kocsis et al. 2019).</p>
</div>
</div>
<div class="section level2">
<h2 id="necessary-data">2. Necessary Data<a class="anchor" aria-label="anchor" href="#necessary-data"></a>
</h2>
<p>Most functionality in the ‘divDyn’ package assumes that the time dimension is broken down to discrete intervals. Accordingly, most functions are built on two fundamental data structures: a time scale table and an occurrence dataset.</p>
<div class="section level3">
<h3 id="time-scales">2.1. Time scales<a class="anchor" aria-label="anchor" href="#time-scales"></a>
</h3>
<p>The workflow presented here is based on the discretization of geological time, which is constrained by stratigraphy. These intervals of time (bins) represent the basic units of the analysis, and their sequence is coded in the time scale table. Even if we develop a geological model that outputs robust estimates in a continuous time axis, the calculation of metrics presented in the package will require discretization. We added implementations of the basic functionalities for continuous time (chapter ‘4.3. Slicing’) as well, but we do not deem it as reliable as using stratigraphic bins for million-year-scale, deep-time analyses. As age estimates are dependent on the different geological ‘time scales’, binning the data can change more than necessary, which can have random effects on the resulting series.</p>
<p>In order to demonstrate the workflow of binned analyses, we added an example table to the package. This table represents a somewhat altered form (see below) of the stage-level geological time scale of Gradstein et al. (2020). You can attach this table using the <code><a href="https://rdrr.io/r/utils/data.html" class="external-link">data()</a></code> function.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">divDyn</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># attach the time scale object</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">stages</span><span class="op">)</span></span></code></pre></div>
<p>Every row in this table represents a bin in the timescale. The most important variable in this table is the slice number (in this case <code>num</code>). This variable links every occurrence to one of the bins. You can gather additional information by typing <code><a href="../reference/stages.html">?stages</a></code> to the console. You can visualize the timescale by using the <code>plots()</code> function included in the package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, shading<span class="op">=</span> <span class="st">"series"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/tsplot1-1.png" width="700"></p>
<p>For easier navigation in the plot, the time dimension can be indicated with three variables: the radiometric dates that serve as coordinates; boxes of intervals under lowest <code>ylim</code> value of the plot; and vertical shades over the plotting area. The time scale to be plotted can be altered by changing the values of the main argument <code>tsdat</code> and by providing the appropriate column names for the boxes and shading arguments. In order to use the system (period) names as labels and the stages as shades, just change the function input accordingly (the <code>xlim</code> values will limit the x axis plot):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, boxes<span class="op">=</span><span class="st">"system"</span>, shading<span class="op">=</span><span class="st">"stage"</span>, xlim<span class="op">=</span><span class="fl">59</span><span class="op">:</span><span class="fl">81</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/tsplot2-1.png" width="700"></p>
<p>The function was designed to enable the highest level of customization. You can customize the distribution of plotting area with the <code>xlim</code> (accepts exact ages and sequences of bins, see the examples), <code>ylim</code>, <code>prop</code> and <code>gap</code> arguments, and the color of the shading. You can also customize the characteristics of the general plotting (calling <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>, the boxes of time slices (calling <code><a href="https://rdrr.io/r/graphics/rect.html" class="external-link">rect()</a></code>) and the labels within them (calling the <code><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text()</a></code> function). You can directly control the arguments of these functions that <code><a href="../reference/tsplot.html">tsplot()</a></code> uses to draw the elements of the timescale by adding the additional arguments as lists to the <code>plot.args</code>, <code>boxes.args</code> and <code>labels.args</code> arguments.<br>
For instance, if you want your boxes to feature red italic fonts as labels, just add col=“red”, and font=3 the way you would regularly use them with the text() function, but wrap them up in a list, and assign it to the ‘labels.args’ argument:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, shading<span class="op">=</span><span class="st">"series"</span>, </span>
<span>  labels.args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>col<span class="op">=</span><span class="st">"red"</span>, font<span class="op">=</span><span class="fl">3</span><span class="op">)</span>, shading.col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"white"</span>, <span class="st">"wheat"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/tsplot3-1.png" width="700"></p>
<p>Although you can set it manually with the <code>boxes.args</code> argument, the time scale plotting function also features colored plotting of the boxes, via the argument <code>boxes.col</code>. The <code>stages</code> object contains hexadecimal RGB codes for the system (period), series (epoch) and stage (age) entries of the ICS table of stratigraphy in the <code>systemCol</code>, <code>seriesCol</code> and <code>col</code> columns, respectively.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, boxes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sys"</span><span class="op">)</span>, shading<span class="op">=</span><span class="st">"sys"</span>, boxes.col<span class="op">=</span><span class="st">"systemCol"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/tsplot4-1.png" width="700"></p>
<p>Plotting of multiple levels as boxes is also supported now. Use vectors of column names if you want to add these.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, boxes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"short"</span>,<span class="st">"system"</span><span class="op">)</span>, shading<span class="op">=</span><span class="st">"short"</span>, </span>
<span>  xlim<span class="op">=</span><span class="fl">59</span><span class="op">:</span><span class="fl">69</span>, boxes.col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"col"</span>,<span class="st">"systemCol"</span><span class="op">)</span>, labels.args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/tsplot5-1.png" width="700"> Accordingly, the <code>boxes.args</code> and <code>labels.args</code> accept hierarchical input that corresponds to the levels of stratigraphic hierarchy.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, boxes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"short"</span>,<span class="st">"system"</span><span class="op">)</span>, shading<span class="op">=</span><span class="st">"short"</span>, </span>
<span>  xlim<span class="op">=</span><span class="fl">59</span><span class="op">:</span><span class="fl">69</span>, boxes.col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"col"</span>,<span class="st">"systemCol"</span><span class="op">)</span>,</span>
<span>  labels.args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  boxes.args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>density<span class="op">=</span><span class="fl">80</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/tsplot6-1.png" width="700"> Naturally, you can use other time scale plotting packages such as the ‘geoscale’ package developed by J. Bell (2015). These work great for Phanerozoic scale analyses, but be sure to check the compatibility of the time scale you use for the binning and the time scale used for plotting. As we have experience with problems that stemmed from the incompatibility of analyzing and plotting data, we recommend using your own timescale for plotting.</p>
</div>
<div class="section level3">
<h3 id="occurrence-table">2.2. Occurrence table<a class="anchor" aria-label="anchor" href="#occurrence-table"></a>
</h3>
<p>The occurrence tables contain unary information about the presence of a taxon at a specified locality (can be global). In these tables, each occurrence is represented by a row which has to include a name of the taxon. This data format is similar to the following example:</p>
<pre><code><span><span class="co">##   tax bin locality</span></span>
<span><span class="co">## 1 Sp1   1    first</span></span>
<span><span class="co">## 2 Sp1   1   second</span></span>
<span><span class="co">## 3 Sp1   2   second</span></span>
<span><span class="co">## 4 Sp2   2   second</span></span>
<span><span class="co">## 5 Sp3   2    first</span></span>
<span><span class="co">## 6 Sp2   3   second</span></span></code></pre>
<p>The functions of the package will have to be pointed to this column, by specifying its name in the <code>tax</code> argument of the function in question. Additional variables can be added that contain specific information about the time and locality of the occurrence, as well as other variables that help with grouping the individual entries (taxon/collection information). The utility of this long format is in its unbounded nature, with the acquisition of newer data points the time and spatial coverage of the dataset can extend without problems.</p>
<div class="section level4">
<h4 id="stratigraphic-assignment">2.2.1. Stratigraphic assignment<a class="anchor" aria-label="anchor" href="#stratigraphic-assignment"></a>
</h4>
<p>Most functions rely on processes that subset the data to contain occurrences that represent the same time interval. This column can be specified with setting the <code>bin</code> argument accordingly. However, to get this column, a number of processes has to be run on the raw data. Although the package already incorporates functions and data to assign downloaded occurrences to stratigraphic bins, those are illustrated in a separate vignette (<a href="http://github.com/divDyn/ddPhanero" class="external-link uri">http://github.com/divDyn/ddPhanero</a>).</p>
</div>
<div class="section level4">
<h4 id="the-example-file">2.2.2. The example file<a class="anchor" aria-label="anchor" href="#the-example-file"></a>
</h4>
<p>In order to demonstrate most capabilities of the package we have added a fossil occurrence table of Scleractinian corals that we used in an earlier study (Kiessling and Kocsis, 2015). This subset was downloaded from the PaleoDB and was extended with information on inferred photosymbiotic status, growth types, degree of integration, ecological environment, inferred depth, substrate lithology and latitudinal groups. Additional details are available by typing <code><a href="../reference/corals.html">?corals</a></code> to the console. This dataset is embedded in the package and can be attached using the data() function:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">corals</span><span class="op">)</span></span></code></pre></div>
<p>This dataset was resolved to the 10 my timescale of the PaleoDB (<code>ten</code>, now only available through FossilWorks) and the stage-level time scale (variable <code>stg</code>) that is included in the package (see Section 2.1, <code>stages</code>). This latter is the basis of all inference and plotting. The values of the <code>stg</code> column of the coral table refers to entries in the <code>num</code> column of the <code>stages</code> table. Please note that this dataset does not include Holocene occurrences. The occurrences designated with <code>stg==95</code> are just single entries that include extant genera; therefore all other entries of this subset are missing, except for the variables linked to the taxa. The rest of the occurrences represent actual fossils.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fossils</span> <span class="op">&lt;-</span> <span class="va">corals</span><span class="op">[</span><span class="va">corals</span><span class="op">$</span><span class="va">stg</span><span class="op">!=</span><span class="fl">95</span>,<span class="op">]</span></span>
<span><span class="co"># the number of occurrences</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">fossils</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 29544</span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="basic-patterns">3. Basic patterns<a class="anchor" aria-label="anchor" href="#basic-patterns"></a>
</h2>
<div class="section level3">
<h3 id="ranges">3.1. Ranges<a class="anchor" aria-label="anchor" href="#ranges"></a>
</h3>
<p>We can gain preliminary knowledge by examining the basic patterns of the stratigraphic ranges . Probably the most apparent of these are the stratigraphic ranges of the taxa, which can be easily summarized in the FAD-LAD matrix:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fadlad.html">fadlad</a></span><span class="op">(</span><span class="va">fossils</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span><span class="op">)</span></span></code></pre></div>
<p>You can also use the occurrences’ own age estimate to calculate the ranges, just type in ?fadlad to see some more examples. The ranges of fossil taxa are the primary data quality feedback we can have from the massive amount of fossil occurrences. You can easilly visualize these with the <code><a href="../reference/ranges.html">ranges()</a></code> function. To keep things simple, just assign the age (stage) mean age to the occurrences:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fossils</span><span class="op">$</span><span class="va">mid</span> <span class="op">&lt;-</span> <span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="va">fossils</span><span class="op">$</span><span class="va">stg</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">260</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ranges.html">ranges</a></span><span class="op">(</span><span class="va">fossils</span>, tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"mid"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/ranplot-1.png" width="700"></p>
<p>The function automatically selects the taxa that have ranges that fall into the <code>xlim</code> values of the open device (you can suppress this if you want to). If you zoom in with the main plotting function, you can see this effect. You can also add the taxon labels by setting the <code>labs</code> argument to <code>TRUE</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"series"</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">81</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ranges.html">ranges</a></span><span class="op">(</span><span class="va">fossils</span>, tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"mid"</span>, labs<span class="op">=</span><span class="cn">T</span>, labels.args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/ranplot2-1.png" width="700"></p>
<p>As you can see from the example above (<code>labs.args</code> argument), the argumentation of this function works in a similar way to the that of the <code><a href="../reference/tsplot.html">tsplot()</a></code> function. You can get an even more detailed look if you set the <code>filt</code> argument to <code>"orig"</code>. This will limit the displayed taxa to those that originated within the interval. <code>occs=TRUE</code> will also plot the sampled occurrences on the ranges.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"stage"</span>, boxes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stage"</span>,<span class="st">"series"</span><span class="op">)</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">80</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ranges.html">ranges</a></span><span class="op">(</span><span class="va">fossils</span>, tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"mid"</span>, labs<span class="op">=</span><span class="cn">T</span>, </span>
<span>  labels.args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span>, filt<span class="op">=</span><span class="st">"orig"</span>, occs<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/ranplot3-1.png" width="700"></p>
<p>This function can also plot the taxa by groups. Here is the same plot, but by separating the taxa based on symbiotic status:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"stage"</span>, boxes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"stage"</span>,<span class="st">"series"</span><span class="op">)</span>,xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">80</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ranges.html">ranges</a></span><span class="op">(</span><span class="va">fossils</span>, tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"mid"</span>, labs<span class="op">=</span><span class="cn">T</span>, </span>
<span>  labels.args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cex<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span>, filt<span class="op">=</span><span class="st">"orig"</span>, occs<span class="op">=</span><span class="cn">T</span>, group<span class="op">=</span><span class="st">"ecology"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/ranplot4-1.png" width="700"></p>
<p>You can also plot survivorship curves. The function <code><a href="../reference/survivors.html">survivors()</a></code> calculates the proportions of survivors from every bin to all the remaining bins.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/survivors.html">survivors</a></span><span class="op">(</span><span class="va">corals</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span><span class="op">)</span></span></code></pre></div>
<p>You can plot these values for every cohort to get survivorship curves. As these curves can be thought of as products of an exponential decay, it is customary to log the y axis, which you can do with adding <code>log="y"</code> to the arguments of the main <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function in <code>plot.args</code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># time scale plot</span></span>
<span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, </span>
<span>  xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">260</span>,<span class="fl">0</span><span class="op">)</span>, ylab<span class="op">=</span><span class="st">"proportion of survivors present"</span>,</span>
<span>  ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">1</span><span class="op">)</span>,plot.args<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>log<span class="op">=</span><span class="st">"y"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/survTsplotblank-1.png" width="700"></p>
<p>Then the curves can be plotted for every column with</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># lines for every cohort</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">surv</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span>, <span class="va">surv</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/survTsplot1-1.png" width="700"></p>
<p>The values shown here are also called ‘forward’ survivorship proportions, but you can also plot the ‘backward’ survivorships to see how certain cohorts emerge over geologic time, by setting the <code>method</code> argument of the survivors() function appropriately:</p>
<p><img src="divDyn_2_handout_files/figure-html/survTsplot2-1.png" width="700"></p>
<p>Large synchronous changes in these curves represent times where major changes happened in the history of the group. Major extinctions are apparent on the forward survivorship, whilst major origination episodes show up on the backward survivorship curves. However, ways that are more robust exist to quantify the factors that influence diversity.</p>
</div>
<div class="section level3">
<h3 id="sampling-parameters">3.2. Sampling parameters<a class="anchor" aria-label="anchor" href="#sampling-parameters"></a>
</h3>
<div class="section level4">
<h4 id="basic-descriptors">3.2.1. Basic descriptors<a class="anchor" aria-label="anchor" href="#basic-descriptors"></a>
</h4>
<p>The patterns of the data are constrained by sampling processes. These can have a direct influence on the patterns of diversity dynamics and therefore should be taken into consideration when the conclusions are drawn from the data.</p>
<p>The <code><a href="../reference/sumstat.html">sumstat()</a></code> function calculates basic sampling metrics that characterize the entire dataset.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samp</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/sumstat.html">sumstat</a></span><span class="op">(</span><span class="va">fossils</span>, tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span>, </span>
<span>  coll<span class="op">=</span><span class="st">"collection_no"</span>, ref<span class="op">=</span><span class="st">"reference_no"</span>, duplicates<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">samp</span></span></code></pre></div>
<pre><code><span><span class="co">##   bins  occs taxa colls refs gappiness</span></span>
<span><span class="co">## 1   41 23229  760  5444 1203 0.5818335</span></span></code></pre>
<p>This includes the total number of occurrences, collections, references and statistics of gappiness. You can also calculate most of these basic sampling metrics for every bin with the <code><a href="../reference/binstat.html">binstat()</a></code> function.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samp</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/binstat.html">binstat</a></span><span class="op">(</span><span class="va">fossils</span>, tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span>, </span>
<span>  coll<span class="op">=</span><span class="st">"collection_no"</span>, ref<span class="op">=</span><span class="st">"reference_no"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## The database contains duplicate occurrences (multiple species/genus).</span></span></code></pre>
<p>The message above indicates that multiple entries of the same genus are present in the same collections. As this is a species-level occurrence dataset, this is understandable. By default, these entries are omitted from the calculations above, but you can toggle this manually by setting the <code>duplicates</code> argument of binstat() accordingly (<code>TRUE</code> will keep the duplicates, <code>FALSE</code> will omit them – without notification).</p>
<p>The function calculates the basic bin-wise statistics that do not require multi-bin pattern recognition (for instance for Alroy’s (2008) three-timer sampling completeness, which is output by the <code><a href="../reference/divDyn.html">divDyn()</a></code> function). Optionally, additional metrics implemented in the <code><a href="../reference/indices.html">indices()</a></code> function can be applied to information in every bin, by adding <code>indices=TRUE</code> to the function call.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samp</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/binstat.html">binstat</a></span><span class="op">(</span><span class="va">fossils</span>, tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span>, </span>
<span>  coll<span class="op">=</span><span class="st">"collection_no"</span>, ref<span class="op">=</span><span class="st">"reference_no"</span>, indices<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## The database contains duplicate occurrences (multiple species/genus).</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">samp</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "stg"       "occs"      "colls"     "refs"      "SIBs"      "occ1"     </span></span>
<span><span class="co">##  [7] "occ2"      "ref1"      "ref2"      "u"         "chao1occ"  "uPrime"   </span></span>
<span><span class="co">## [13] "chao1ref"  "richness"  "shannon"   "hill2"     "dominance" "squares"  </span></span>
<span><span class="co">## [19] "chao2"     "SCOR"</span></span></code></pre>
<p>All results of the output of this function can be plotted then in a straightforward way, by referring to the elements of the data frame. For instance, the <code>occs</code> element contains the number of sampled occurrences and <code>coll</code> refers to the number of collections:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oldPar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># basic plot</span></span>
<span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>    ylab<span class="op">=</span><span class="st">"number of occurrences"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">samp</span><span class="op">$</span><span class="va">occs</span><span class="op">)</span></span>
<span><span class="co"># the collections (rescaled, other axis)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">samp</span><span class="op">$</span><span class="va">colls</span><span class="op">*</span><span class="fl">5</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">4</span>, col<span class="op">=</span><span class="st">"blue"</span>,col.ticks<span class="op">=</span><span class="st">"blue"</span>,col.axis<span class="op">=</span><span class="st">"blue"</span>,</span>
<span>    at<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3000</span>,<span class="fl">500</span><span class="op">)</span>, labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">600</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html" class="external-link">mtext</a></span><span class="op">(</span><span class="fl">4</span>, text<span class="op">=</span><span class="st">"number of collections"</span>, col<span class="op">=</span><span class="st">"blue"</span>, line<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/occsAndColls-1.png" width="700"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">oldPar</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/binstat.html">binstat()</a></code> function also calculates other basic statistics such as the numbers of references, sampled taxa, single-collection taxa, single-reference taxa, double collection and double reference taxa along with the sampling coverage estimator Good’s <em>u</em> (1953), the coverage estimator suggested by Alroy (<em>u’ </em>, 2010) that is based on the number of single-reference taxa.</p>
</div>
<div class="section level4">
<h4 id="plotting-of-counts-and-proportions">3.2.2. Plotting of counts and proportions<a class="anchor" aria-label="anchor" href="#plotting-of-counts-and-proportions"></a>
</h4>
<p>You can trace the trajectory of the occurrences that have different attributes through the bins by using the <code><a href="../reference/parts.html">parts()</a></code> function. This requires only two arguments: vector of bin identifiers and a vector that contains the categories entries. The bin identifier also determines the coordinates along the independent variable (time), so the numerical bin entries have to be replaced by the age estimates.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># numerical ages, as bins</span></span>
<span><span class="va">fossils</span><span class="op">$</span><span class="va">stgMid</span> <span class="op">&lt;-</span> <span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="va">fossils</span><span class="op">$</span><span class="va">stg</span><span class="op">]</span></span>
<span><span class="co">#plotting</span></span>
<span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>  ylab<span class="op">=</span><span class="st">"number of occurences"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/parts.html">parts</a></span><span class="op">(</span><span class="va">fossils</span><span class="op">$</span><span class="va">stgMid</span>, <span class="va">fossils</span><span class="op">$</span><span class="va">bath</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/parts-1.png" width="700"></p>
<p>If you check out <code><a href="../reference/parts.html">?parts</a></code>, there will be additional examples using artificial data. In the default case, the category names are plotted where they are the most abundant. This plot can be even nicer if you use opacity (RGBA values for colors) and adding a proper legend.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#FF0000AA"</span>, <span class="st">"#00FF00AA"</span>, <span class="st">"#0000FFAA"</span><span class="op">)</span></span>
<span><span class="co"># reorder too</span></span>
<span><span class="va">reord</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shal"</span>,<span class="st">"deep"</span>,<span class="st">"uk"</span><span class="op">)</span></span>
<span><span class="va">plotnames</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"shallow"</span>, <span class="st">"deep"</span>, <span class="st">"unknown"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>    ylab<span class="op">=</span><span class="st">"the number of occurrences"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">3000</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/parts.html">parts</a></span><span class="op">(</span><span class="va">fossils</span><span class="op">$</span><span class="va">stgMid</span>, <span class="va">fossils</span><span class="op">$</span><span class="va">bath</span>, col<span class="op">=</span><span class="va">cols</span>, ord<span class="op">=</span><span class="va">reord</span>, labs<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, inset<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.01</span><span class="op">)</span>, </span>
<span>  legend<span class="op">=</span> <span class="va">plotnames</span>, fill<span class="op">=</span><span class="va">cols</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/parts2-1.png" width="700"></p>
<p>The dominance of shallow occurrences are even more apparent with proportions. You can use the <code>parts</code> function to plot these, rather than the counts, by adding <code>prop=T</code> to the function call:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>    ylab<span class="op">=</span><span class="st">"proportion of occurrences"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/parts.html">parts</a></span><span class="op">(</span><span class="va">fossils</span><span class="op">$</span><span class="va">stgMid</span>, <span class="va">fossils</span><span class="op">$</span><span class="va">bath</span>, prop<span class="op">=</span><span class="cn">T</span>, col<span class="op">=</span><span class="va">cols</span>, ord<span class="op">=</span><span class="va">reord</span>, labs<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"bottomleft"</span>, inset<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.1</span><span class="op">)</span>, </span>
<span>  legend<span class="op">=</span> <span class="va">plotnames</span>, fill<span class="op">=</span><span class="va">cols</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/parts3-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="single-collection-and-single-reference-taxa">3.2.3. Single-collection and single reference taxa<a class="anchor" aria-label="anchor" href="#single-collection-and-single-reference-taxa"></a>
</h4>
<p>Single-interval taxa were thought to be byproducts of temporary increases of sampling intensity (Foote and Raup, 1996) in range-based datasets such as Sepkoski’s compendium (2002). This phenomenon urged researchers to develop metrics that ignore these taxa in calculating metrics of biodiversity and evolution. Single-collection taxa can be quickly omitted from the datasets by using the <code><a href="../reference/omit.html">omit()</a></code> function. This will return a logical vector, indicating the rows that should be omitted. The <code>om</code> argument can be set either to omit the single-collection occurrences (<code>om="coll"</code>). Single-reference taxa can be omitted in the same way, although the term needs additional clarification if multiple bins exist. Taxa that were only described in a single reference (<code>om="ref"</code>). Some taxa appear in multiple bins and in each of them they are described by only one reference. These you can omit with <code>om="binref"</code>.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">omitColl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/omit.html">omit</a></span><span class="op">(</span><span class="va">corals</span>, tax<span class="op">=</span><span class="st">"genus"</span>, om<span class="op">=</span><span class="st">"coll"</span>, coll<span class="op">=</span><span class="st">"collection_no"</span><span class="op">)</span></span>
<span><span class="va">omitRef</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/omit.html">omit</a></span><span class="op">(</span><span class="va">corals</span>, tax<span class="op">=</span><span class="st">"genus"</span>, om<span class="op">=</span><span class="st">"ref"</span>, ref<span class="op">=</span><span class="st">"reference_no"</span><span class="op">)</span></span>
<span><span class="va">omitBinref</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/omit.html">omit</a></span><span class="op">(</span><span class="va">corals</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, om<span class="op">=</span><span class="st">"binref"</span>, ref<span class="op">=</span><span class="st">"reference_no"</span><span class="op">)</span></span>
<span><span class="co"># the conserved number of occurrences will be</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">omitColl</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 29583</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">omitRef</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 29489</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="va">omitBinref</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 29105</span></span></code></pre>
</div>
</div>
</div>
<div class="section level2">
<h2 id="raw-diversity-dynamics">4. Raw diversity dynamics<a class="anchor" aria-label="anchor" href="#raw-diversity-dynamics"></a>
</h2>
<p>The main calculations of the package are contained in the <code><a href="../reference/divDyn.html">divDyn()</a></code> function. This function calculates patterns of taxon occurrences and stratigraphic ranges to derive estimates over time for richness, origination/extinction rates and sampling probabilities. In order to calculate these you only need an occurrence table with variables including the taxon names (<code>tax</code>) and the time identifiers (<code>bin</code>). The rest of the information in the table will not be used by the function.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ddFirst</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/divDyn.html">divDyn</a></span><span class="op">(</span><span class="va">corals</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, noNAStart<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The output of the <code><a href="../reference/divDyn.html">divDyn()</a></code> function is a <code>data.frame</code> class object that contains values for each bins in rows. The first column (<code>bin</code> variable) contains the bin identifiers. The rest of the variables are explained in the documentation.</p>
<div class="section level3">
<h3 id="diversity-taxonomic-richness-with-discrete-time-input">4.1. Diversity (taxonomic richness) with discrete time input<a class="anchor" aria-label="anchor" href="#diversity-taxonomic-richness-with-discrete-time-input"></a>
</h3>
<p>You read this because you have interests in the changes of diversity. Calculating time series of diversity does not require additional action than running the basic <code><a href="../reference/divDyn.html">divDyn()</a></code> function.</p>
<div class="section level4">
<h4 id="taxon-counts">4.1.1.Taxon counts<a class="anchor" aria-label="anchor" href="#taxon-counts"></a>
</h4>
<p>All calculations in this function depend on patterns of occurrences in the bin/taxon matrix. The numbers of taxa that belong to different categories form the basis of the metrics. These categories are explained by Foote (1999) and Alroy (2014) and are available in the help file <code><a href="../reference/divDyn.html">?divDyn</a></code>.</p>
</div>
<div class="section level4">
<h4 id="different-metrics-of-richness">4.1.2. Different metrics of richness<a class="anchor" aria-label="anchor" href="#different-metrics-of-richness"></a>
</h4>
<p>Calculating time series of diversity does not require additional action than running the basic <code><a href="../reference/divDyn.html">divDyn()</a></code> function. In this package, among the traditional range-based methods the range-through (variable <code>divRT</code>) and the boundary-crosser (<code>divBC</code>) diversities are implemented. Plotting can be also facilitated by matching the indices of the diversity values in the variables and their numbers. If the bin numbers are positive integers this is turned on by setting the <code>noNAStart</code> argument to <code>FALSE</code>, which is the default. This change results in <code>NA</code>s and zeros in the final table in rows, which bins are not sampled.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># metrics</span></span>
<span><span class="va">ddRec</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/divDyn.html">divDyn</a></span><span class="op">(</span><span class="va">corals</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span><span class="op">)</span></span>
<span><span class="co"># basic plot</span></span>
<span>  <span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>    ylab<span class="op">=</span><span class="st">"range-through richness (diversity)"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">250</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># lines</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span>, <span class="va">ddRec</span><span class="op">$</span><span class="va">divRT</span>, col<span class="op">=</span><span class="st">"black"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/ddRec-1.png" width="700"></p>
<p>This plot shows the trajectory of coral diversity over the post-Permian interval, using raw data and the range-through diversity metric. Besides the 0 values at the start of the time series (no sampled corals), you might also notice a sharp increase of richness in the latest intervals. This could be the result of an effect called the ‘Pull of the Recent’. The ‘Pull of the Recent’ (Raup, 1979) is a smearing phenomenon that arises when range-based methods are calculated from datasets where sampling probability changes abruptly. As we know the Recent much better in comparison to other intervals (sampling probability is much higher, around one), the number of ranges that connect first occurrences of taxa to the extant time interval (<code>stg == 95</code>) is much higher than those that link two non-Recent time intervals. The results in spur of diversity as the Recent is approached. On the other hand, omitting the recent interval (effectively decreasing sampling probability to 0) leads to edge effects that result in the opposite phenomenon. The discrepancy between these two approaches can be visualized by the omission of the recent ‘occurrences’:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># metrics</span></span>
<span><span class="va">dd</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/divDyn.html">divDyn</a></span><span class="op">(</span><span class="va">fossils</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span><span class="op">)</span></span>
<span><span class="co"># basic plot</span></span>
<span>  <span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>    ylab<span class="op">=</span><span class="st">"richness (diversity)"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">250</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># lines</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span>, <span class="va">ddRec</span><span class="op">$</span><span class="va">divRT</span>, col<span class="op">=</span><span class="st">"black"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">dd</span><span class="op">$</span><span class="va">divRT</span>, col<span class="op">=</span><span class="st">"blue"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># legend</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"with recent"</span>, <span class="st">"without recent"</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"blue"</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/ddFossils-1.png" width="700"></p>
<p>Over the last couple of decades, a number of metrics were proposed to efficiently express diversity given such distorting effects of incomplete sampling and the discretized time dimension. As these more straightforward approaches that use range interpolations have known issues, occurrence datasets, allow the calculation of more direct estimators, such as sampled-in-bin (SIB, variable <code>divSIB</code>) diversities.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># metrics</span></span>
<span><span class="va">dd</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/divDyn.html">divDyn</a></span><span class="op">(</span><span class="va">fossils</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span><span class="op">)</span></span>
<span><span class="co"># basic plot</span></span>
<span>  <span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>    ylab<span class="op">=</span><span class="st">"richness (diversity)"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">250</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># lines</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">dd</span><span class="op">$</span><span class="va">divRT</span>, col<span class="op">=</span><span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">dd</span><span class="op">$</span><span class="va">divBC</span>, col<span class="op">=</span><span class="st">"blue"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">dd</span><span class="op">$</span><span class="va">divSIB</span>, col<span class="op">=</span><span class="st">"green"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># legend</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"RT"</span>, <span class="st">"BC"</span>, <span class="st">"SIB"</span><span class="op">)</span>, </span>
<span>    col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span>,   <span class="st">"green"</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/ddDiv-1.png" width="700"></p>
<p>Although range-interpolation does not bias the ‘SIB’ metric, it is more affected by changes of sampling intensity sampling. The three-timer sampling completeness is an effective expression of changes in sampling (<code>samp3t</code> variable):</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># basic plot</span></span>
<span>  <span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>    ylab<span class="op">=</span><span class="st">"three-timer sampling completeness"</span><span class="op">)</span></span>
<span>  <span class="co"># lines</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">dd</span><span class="op">$</span><span class="va">samp3t</span>, col<span class="op">=</span><span class="st">"black"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/samp3t-1.png" width="700"></p>
<p>The SIB series can be partially corrected by the three-timer sampling-completeness (Alroy §ref ). Although this can be a convenient correction it also increases the estimation error. Nevertheless, this is the least biased estimator for diversity.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># basic plot</span></span>
<span>  <span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>    ylab<span class="op">=</span><span class="st">"three-timer sampling completeness"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">250</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">dd</span><span class="op">$</span><span class="va">divSIB</span>, col<span class="op">=</span><span class="st">"black"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">dd</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"blue"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># legend</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SIB"</span>, <span class="st">"corrected SIB"</span> <span class="op">)</span>, </span>
<span>    col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"blue"</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/ddCorr-1.png" width="700"> The <code><a href="../reference/omit.html">omit()</a></code> function is also embedded in the <code><a href="../reference/divDyn.html">divDyn()</a></code> function, so that the metrics are calculated after the omission of poorly sampled taxa (switched off by default). You can add this filter, by adding (the appropriate <code>om</code> arguments to the <code><a href="../reference/divDyn.html">divDyn()</a></code> function call.</p>
</div>
</div>
<div class="section level3">
<h3 id="taxonomic-rates-with-discrete-time-input">4.2. Taxonomic rates with discrete time input<a class="anchor" aria-label="anchor" href="#taxonomic-rates-with-discrete-time-input"></a>
</h3>
<p>Analyzing time series of originations and extinctions helps us to describe not just how diversity changed over time, by also why it changed. With taxonomic rates we can decompose changes in diversity to the relative contribution of cladogenetic processes (i.e. origination, the birth of a new taxon) and that of the disappearance of taxa (i.e. extinction, the death of a taxon). In the discrete time model, the most straightforward way to express these contributions is through simple exponential decay models (Raup, 1985). For convenience, these variables are named as <code>extTYPE</code> and <code>oriTYPE</code> for extinction and origination rates, respectively.</p>
<div class="section level4">
<h4 id="different-metrics-of-turnover">4.2.1. Different metrics of turnover<a class="anchor" aria-label="anchor" href="#different-metrics-of-turnover"></a>
</h4>
<p>In the package, the proportional rates (<code>extProp</code> and <code>oriProp</code>) and per capita rates (<code>extPC</code> and <code>oriPC</code>) of Foote (1999), the three-timer rates (<code>ext3t</code> and <code>ori3t</code>) of Alroy (2008), their corrected counterparts (<code>extC3t</code> and <code>oriC3t</code>), the gap-filler rates (<code>extGF</code> and <code>oriGF</code>) of Alroy (2014) and the improved second-for-third (<code>ext2f3</code> and <code>ori2f3</code>) of Alroy (2015) are provided.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># basic plot</span></span>
<span>  <span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>    ylab<span class="op">=</span><span class="st">"extinction rates"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">dd</span><span class="op">$</span><span class="va">extPC</span>, col<span class="op">=</span><span class="st">"black"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">dd</span><span class="op">$</span><span class="va">extGF</span>, col<span class="op">=</span><span class="st">"blue"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">dd</span><span class="op">$</span><span class="va">ext2f3</span>, col<span class="op">=</span><span class="st">"green"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="co"># legend</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"per capita"</span>, <span class="st">"gap-filler"</span>, <span class="st">"second-for-third"</span><span class="op">)</span>,</span>
<span>    col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/ddExt-1.png" width="700"></p>
<p>The documentation of the function (type in console ?divDyn) contains the formulas for the calculation of the rates. With heterogeneous, incomplete sampling the metrics have different properties that can be summarized as follows:</p>
<ul>
<li><p>Proportional ‘rates’: These metrics express what proportion of the cohort of taxa disappears until the new interval.</p></li>
<li><p>The per capita rates of Foote (1999) use the range-through assumption to establish ranges for the taxa in the dataset. The rate value expresses what proportion of the taxa decayed until the end of the interval. The method is biased by the Signor-Lipps effect and edge effects (Foote 2000).</p></li>
<li><p>The ‘three-timer’ and ‘corrected three-timer’ rates (Alroy, 2008) are different estimators of the per capita rates but will converge on them when sampling tends to completeness. They use moving windows around the focal interval to select data that is more relevant to the focal interval. This metric is unbiased by the Signor-Lipps and edge effects. The three-timer sampling completeness can be used to correct this metric, but it will not improve its susceptibility to random sampling error.</p></li>
<li><p>The ‘gap-filler’ rates (Alroy, 2014): gap-filler extinction rates are improved versions of the three-timer rates, using four-bin moving windows instead of three. This makes the rates less resistant to random error (more taxa are recognized by the categorizing procedure) and are an improvement on the three-timer rates. The method sometimes results in the seemingly nonsensical negative extinction rates, when the true extinction rates are near 0.</p></li>
<li><p>The ‘second-for-third’ rates (Alroy, 2015) are further improvement of ideas the three-timer and gap-filler rates represent. By adding an algorithmic approach the frequency of negative extinction rates are further decreased. Extinction and origination proportions described by Alroy (2015) can also be used (<code>E2f3</code> and <code>O2f3</code>, respectively).</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="selectivity-testing-for-the-per-capita-rates">4.2.2. Selectivity testing for the per capita rates<a class="anchor" aria-label="anchor" href="#selectivity-testing-for-the-per-capita-rates"></a>
</h4>
<p>Although extinction and origination rates can provide information about events and background processes on their own, sometimes it is more useful to assess them in comparison between taxa. The most frequent way of doing this is by splitting a group to subsets and comparing the patterns of turnover in certain intervals between the two groups. In the case of selectivity testing, an ecologically, taxonomically important grouping variable indicates that one of the groups has a higher turnover at a specific point in time. For the sake of convenience in hypothesis testing for selectivity for one state of the variable (e.g. heavily calcified), the available methods assess selectivity between two groups.</p>
<p>The general problem of extinction selectivity is the error estimation of the rate values. More data (e.g. more taxa) will lead to more reliable estimates while, splitting the same dataset to two subsets will lead to higher uncertainty in the rate estimates for the two rate values in the selected interval. The selectivity testing incorporates two aspects: (1) the difference between the two rate values, (2) and whether this distance is meaningful or not. In practice, these two criteria can be summarized by whether it is more supported by the data to describe two rate values, or is it better founded to describe just one. These two alternatives are sometimes called as <em>single-rate model</em> and the <em>dual-rate model</em> (Kiessling and Simpson, 2011; Kiessling and Kocsis, 2015). In the case that a dual rate model is better supported, that means that the difference between the two values of rates is statistically meaningful, and the extinction or origination event selectively affected the group with the higher value. For example, here are the raw origination rates of corals, plotted for the <em>az</em> and the <em>z</em> group separately and together:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># split by ecology (az = azooxanthellate, z = zooxantehllate)</span></span>
<span>  <span class="va">z</span><span class="op">&lt;-</span> <span class="va">fossils</span><span class="op">[</span><span class="va">fossils</span><span class="op">$</span><span class="va">ecology</span><span class="op">==</span><span class="st">"z"</span>,<span class="op">]</span></span>
<span>  <span class="va">az</span><span class="op">&lt;-</span> <span class="va">fossils</span><span class="op">[</span><span class="va">fossils</span><span class="op">$</span><span class="va">ecology</span><span class="op">==</span><span class="st">"az"</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># calculate diversity dynamics</span></span>
<span>  <span class="va">ddZ</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/divDyn.html">divDyn</a></span><span class="op">(</span><span class="va">z</span>, tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span><span class="op">)</span></span>
<span>  <span class="va">ddAZ</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/divDyn.html">divDyn</a></span><span class="op">(</span><span class="va">az</span>, tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># origination rate plot</span></span>
<span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, shading<span class="op">=</span><span class="st">"series"</span>, xlim<span class="op">=</span><span class="fl">54</span><span class="op">:</span><span class="fl">95</span>, </span>
<span>  ylab<span class="op">=</span><span class="st">"raw per capita originations"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">dd</span><span class="op">$</span><span class="va">oriPC</span>, lwd<span class="op">=</span><span class="fl">2</span>, lty<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">ddZ</span><span class="op">$</span><span class="va">oriPC</span>, lwd<span class="op">=</span><span class="fl">2</span>, lty<span class="op">=</span><span class="fl">1</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">ddAZ</span><span class="op">$</span><span class="va">oriPC</span>, lwd<span class="op">=</span><span class="fl">2</span>, lty<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, inset<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.1</span><span class="op">)</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"total"</span>, <span class="st">"z"</span>, <span class="st">"az"</span><span class="op">)</span>, </span>
<span>  lwd<span class="op">=</span><span class="fl">2</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/selPrim-1.png" width="700"></p>
<p>The question that arises in this case is whether some intervals can be characterized by actually higher origination rates (for <em>az</em> taxa in the Cretaceous), or is this just a sampling artifact. The testing framework is implemented currently only for the per capita extinction rates of Foote (1999) in the <code>ratesplit</code> function. The function will take the occurrence dataset as an argument and will calculate the rates values similarly to the <code>divDyn</code> function. The function requires a separator variable for the selection testing (<code>sel</code>) that will be used for splitting the dataset into two (this column has to have two possible states i.e. binary code). The implementation of the process for the symbiotic status is:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rs</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/ratesplit.html">ratesplit</a></span><span class="op">(</span><span class="va">fossils</span>, sel<span class="op">=</span><span class="st">"ecology"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span><span class="op">)</span></span>
<span><span class="va">rs</span></span></code></pre></div>
<pre><code><span><span class="co">## $ext</span></span>
<span><span class="co">## integer(0)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $ori</span></span>
<span><span class="co">## [1] 57 59 75 81</span></span></code></pre>
<p>The default output of this function by default is a list of two vectors: <code>ext</code> and <code>ori</code>, extinction rates and origination rates, respectively. Each vector contains the bin numbers where the dual rate model is better supported than the single rate model, where selectivity is plausible. In the example above, selectivity for the extinctions is unlikely and it is supported for bin 57 (Norian), 59 (Hettangian), 75 (Albian) and 81 (Maastrichtian). The statistical testing in this case is based on the number of taxa and can be performed in two different ways, set with the <code>method</code> argument. The less stringent <code>binom</code> method implements binomial testing, with a significance value set with the <code>alpha</code> parameter that defaults to 0.05.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rsBin95</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/ratesplit.html">ratesplit</a></span><span class="op">(</span><span class="va">fossils</span>, sel<span class="op">=</span><span class="st">"ecology"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, </span>
<span>  bin<span class="op">=</span><span class="st">"stg"</span>, method<span class="op">=</span><span class="st">"binom"</span><span class="op">)</span></span>
<span><span class="va">rsBin95</span></span></code></pre></div>
<pre><code><span><span class="co">## $ext</span></span>
<span><span class="co">## [1] 62</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $ori</span></span>
<span><span class="co">## [1] 57 59 75 79 81 83 88</span></span></code></pre>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rsBin90</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/ratesplit.html">ratesplit</a></span><span class="op">(</span><span class="va">fossils</span>, sel<span class="op">=</span><span class="st">"ecology"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, </span>
<span>  bin<span class="op">=</span><span class="st">"stg"</span>, method<span class="op">=</span><span class="st">"binom"</span>, alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">rsBin90</span></span></code></pre></div>
<pre><code><span><span class="co">## $ext</span></span>
<span><span class="co">## [1] 62 80</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $ori</span></span>
<span><span class="co">##  [1] 57 59 65 74 75 76 79 81 82 83 88</span></span></code></pre>
<p>The more conservative approach is to use model selection criteria for the testing of support for the <em>single </em> or <em>dual rate models</em>, which involves calculating Akaike Information Criteria and then Akaike weights. This is the default method (<code>method=AIC</code>). The <code>alpha</code> argument in this case depicts the minimum Akaike weight that serves as a threshold for the <em>dual rate model</em> to be supported. As the ratio of these weights represent likelihood ratios, by default it is set to 0.89 that roughly represents 8 times higher likelihood for the <em>dual rate model</em>. This can be toggled the way it is deemed useful for the question at hand.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rsAIC0.5</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/ratesplit.html">ratesplit</a></span><span class="op">(</span><span class="va">fossils</span>, sel<span class="op">=</span><span class="st">"ecology"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, </span>
<span>  bin<span class="op">=</span><span class="st">"stg"</span>, alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">rsAIC0.5</span></span></code></pre></div>
<pre><code><span><span class="co">## $ext</span></span>
<span><span class="co">## [1] 57 66 80 81</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $ori</span></span>
<span><span class="co">##  [1] 57 59 65 74 75 76 81 82 83 88 91</span></span></code></pre>
<p>In the case above, the 0.5 <code>alpha</code> value indicates that the dual rate model should be supported if it is more likely than the single rate model.</p>
<p>This output, listing supported intervals, is useful for plotting the selectivity values that could be easily visualized by dots. You can add these to the plot of <em>z</em> and <em>az</em> coral origination rates by running:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># select rate values in the intervals of selectivity</span></span>
<span><span class="va">selIntervals</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">ddZ</span><span class="op">$</span><span class="va">oriPC</span>, <span class="va">ddAZ</span><span class="op">$</span><span class="va">oriPC</span><span class="op">)</span><span class="op">[</span><span class="va">rs</span><span class="op">$</span><span class="va">ori</span>,<span class="op">]</span></span>
<span><span class="co"># which is higher? TRUE: AZ, FALSE: Z</span></span>
<span><span class="va">groupSelector</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">selIntervals</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">&lt;</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># draw the points</span></span>
<span><span class="co"># for the AZ corals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span></span>
<span>  <span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="va">rs</span><span class="op">$</span><span class="va">ori</span><span class="op">[</span><span class="va">groupSelector</span><span class="op">]</span><span class="op">]</span>, </span>
<span>  <span class="va">ddAZ</span><span class="op">$</span><span class="va">oriPC</span><span class="op">[</span><span class="va">rs</span><span class="op">$</span><span class="va">ori</span><span class="op">[</span><span class="va">groupSelector</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  pch<span class="op">=</span><span class="fl">16</span>, col<span class="op">=</span><span class="st">"red"</span>, cex<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># for the Z corals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span></span>
<span>  <span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="va">rs</span><span class="op">$</span><span class="va">ori</span><span class="op">[</span><span class="op">!</span><span class="va">groupSelector</span><span class="op">]</span><span class="op">]</span>, </span>
<span>  <span class="va">ddZ</span><span class="op">$</span><span class="va">oriPC</span><span class="op">[</span><span class="va">rs</span><span class="op">$</span><span class="va">ori</span><span class="op">[</span><span class="op">!</span><span class="va">groupSelector</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  pch<span class="op">=</span><span class="fl">16</span>, col<span class="op">=</span><span class="st">"blue"</span>, cex<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/selDotShow-1.png" width="700"> The <code>combine</code> method will employ both schemes for testing, but with the default alpha levels, the binomial test would not limit the set of selective intervals further than the one base on <code>AIC</code>.</p>
<p>Naturally the <code><a href="../reference/ratesplit.html">ratesplit()</a></code> function can return the <em>p</em>-values of the binomial tests and the Akaike weights by setting the <code>output</code> argument to <code>"full"</code> .</p>
</div>
</div>
<div class="section level3">
<h3 id="diversity-dynamics-with-age-input">4.3. Diversity dynamics with age input<a class="anchor" aria-label="anchor" href="#diversity-dynamics-with-age-input"></a>
</h3>
<p>The added option to use a time variable that contains real values allows users to use different data to express the passing of time. This addition enables the application of the basic function to examples of high temporal resolution, where time is close to continuous, or samples in relative time such as expressed by meters within the section.</p>
<div class="section level4">
<h4 id="using-the-bin-argument-unique-values-code-intervals">4.3.1. Using the <code>bin</code> argument – unique values code intervals<a class="anchor" aria-label="anchor" href="#using-the-bin-argument-unique-values-code-intervals"></a>
</h4>
<p>In the case of the coral dataset, we can try this numerical binning approach by assigning the estimated age mid points to the occurrences. This is a very ‘dirty’ way of treating occurrence data as the assumed uncertainty of the age estimate is practically reduced to 0, and overlapping intervals that express uncertainty will have different assigned bins.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fossils</span><span class="op">$</span><span class="va">mid_ma</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">fossils</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"max_ma"</span>,<span class="st">"min_ma"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span></span></code></pre></div>
<p>If this column is set as the <code>bin</code> argument, then occurrences will be treated to represent the same time interval that have the same value in this column. The entries will be ordered by the function. Similarly to physical systems time is assumed to flow from lower to larger values when it is provided as the <strong><code>bin</code></strong> argument. This means that <strong>time has to be reversed, otherwise extinctions become originations and vice versa</strong>. You can toggle this by setting <code>revtime=TRUE</code>.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ddIDbin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/divDyn.html">divDyn</a></span><span class="op">(</span><span class="va">fossils</span>, tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"mid_ma"</span>, revtime<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Please note that this is example is for illustration purposes only. As there are too many unique entries in this <code>bin</code> variable, with the corals, this resolution will be too high to produce potentially meaningful patterns. Range-through diversities are possibly the closest to reality with this method. With this type of binning, the first variable of the <code>divDyn</code> output (name specified in <code>bin</code>) contains the ages for the bins, which you can use for plotting.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># basic plot</span></span>
<span>  <span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>    ylab<span class="op">=</span><span class="st">"Diversity, range-through"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">300</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">ddIDbin</span><span class="op">$</span><span class="va">mid_ma</span>, <span class="va">ddIDbin</span><span class="op">$</span><span class="va">divRT</span>, col<span class="op">=</span><span class="st">"black"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">dd</span><span class="op">$</span><span class="va">divRT</span>, col<span class="op">=</span><span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"unique mid entries"</span>,  <span class="st">"stg stages"</span><span class="op">)</span>,</span>
<span>  col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"red"</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/ddBasic-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="slicing-slice-and-the-age-argument-of-divdyn">4.3.2. Slicing: <code>slice()</code> and the <code>age</code> argument of <code>divDyn()</code><a class="anchor" aria-label="anchor" href="#slicing-slice-and-the-age-argument-of-divdyn"></a>
</h4>
<p>The term slicing refers to the discretization of continuous time. A potentially more promising solution is to assign the occurrences that go along a continuous time scale to regularly spaced bins. However, we have to keep the direction of time in mind: age values decrease as time passes by. This is achieved with the <code><a href="../reference/slice.html">slice()</a></code> function, that can also produce a time scale object, similarly to the <code>stages</code> <code>data.frame</code>. This function converts a continuous time vector to positive integers. To achieve this, you have to supply a numeric vector to the <code>breaks</code> argument function. The entries in this vector will represent the breakpoints or boundaries of the interval, similarly to the <code>breaks</code> argument of the <code><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut()</a></code> or <code><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist()</a></code> function in the base R distribution. For the sake of simplicity, let’s try a 10 million year bin resolution.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># resolve time</span></span>
<span>  <span class="va">breakPoints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">270</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">sliTen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/slice.html">slice</a></span><span class="op">(</span><span class="va">fossils</span><span class="op">$</span><span class="va">mid_ma</span>, breaks<span class="op">=</span><span class="va">breakPoints</span>, ts<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">sliTen</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 2</span></span>
<span><span class="co">##  $ slc: num [1:29544] 11 12 12 12 12 12 12 16 16 16 ...</span></span>
<span><span class="co">##  $ ts :'data.frame': 27 obs. of  4 variables:</span></span>
<span><span class="co">##   ..$ bottom: num [1:27] 270 260 250 240 230 220 210 200 190 180 ...</span></span>
<span><span class="co">##   ..$ mid   : num [1:27] 265 255 245 235 225 215 205 195 185 175 ...</span></span>
<span><span class="co">##   ..$ top   : num [1:27] 260 250 240 230 220 210 200 190 180 170 ...</span></span>
<span><span class="co">##   ..$ slc   : num [1:27] 1 2 3 4 5 6 7 8 9 10 ...</span></span></code></pre>
<p>The first element of the output list (<code>$slc</code>) is the discretized version of the original vector, with reversed time: in the original vector it was flowing from higher to lower values, whereas in <code>$slc</code> time flows from lower to higher values. The second element is the time scale object that is synthesized from the given <code>breaks</code>. It also has an <code>$slc</code> column that reflects the connection between the age estimates and the slice numbers. This output can be used to run the <code><a href="../reference/divDyn.html">divDyn()</a></code> function and to visualize the results</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># assign new column to the data frame</span></span>
<span><span class="va">fossils</span><span class="op">$</span><span class="va">slc</span> <span class="op">&lt;-</span> <span class="va">sliTen</span><span class="op">$</span><span class="va">slc</span></span>
<span><span class="co"># run divDyn with the new column</span></span>
<span>  <span class="va">auto10</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/divDyn.html">divDyn</a></span><span class="op">(</span><span class="va">fossils</span>, tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"slc"</span><span class="op">)</span></span>
<span>  <span class="va">auto10</span><span class="op">$</span><span class="va">divRT</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1]  NA  NA  24  56  55  87  77  45  73  80 150 165 165 165 194 197 189 184 150</span></span>
<span><span class="co">## [20] 156 165 126 124 173 165 183 177</span></span></code></pre>
<p>Note, that the rows of the divDyn() output are aligned with the rows of the <code><a href="../reference/slice.html">slice()</a></code> output <code>sliTen$ts</code>. The results are practically identical to when you do the binning automatically with the <code>age</code> argument of the <code><a href="../reference/divDyn.html">divDyn()</a></code> function.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># and calculate diversity dynamics</span></span>
<span>  <span class="va">ddMid10</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/divDyn.html">divDyn</a></span><span class="op">(</span><span class="va">fossils</span>, tax<span class="op">=</span><span class="st">"genus"</span>, age<span class="op">=</span><span class="st">"mid_ma"</span>, breaks<span class="op">=</span><span class="va">breakPoints</span><span class="op">)</span></span>
<span>  <span class="va">ddMid10</span><span class="op">$</span><span class="va">divRT</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1]   0   0  24  56  55  87  77  45  73  80 150 165 165 165 194 197 189 184 150</span></span>
<span><span class="co">## [20] 156 165 126 124 173 165 183 177</span></span></code></pre>
<p>In this case, the <code>age</code> variable of the output will contain the mid ages of the discrete intervals. Do not worry about setting the exact values for the start and end of slicing (<code>270</code> and <code>0</code> in the example above). If no data occurs in the outlined bins, then the corresponding rows will be empty in the table.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># lines  </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">ddMid10</span><span class="op">$</span><span class="va">mid_ma</span>, <span class="va">ddMid10</span><span class="op">$</span><span class="va">divRT</span>, col<span class="op">=</span><span class="st">"blue"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># new legend</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age estimates, 10MY"</span>,  </span>
<span>  <span class="st">"stg stages"</span>, <span class="st">"unique mid entries"</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"black"</span><span class="op">)</span>,</span>
<span>  lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/dd10actual-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="summary-about-slicing-and-the-direction-of-time">4.3.3. Summary – about slicing and the direction of time<a class="anchor" aria-label="anchor" href="#summary-about-slicing-and-the-direction-of-time"></a>
</h4>
<p>It is better practice to use discretized time for analyses, as the nature of the data supports it better. Interval names are more conservative than age estimates that tend to vary with the evolving geologic timescale, whereas the stratigraphic positions of fossils barely change. In case you only have age estimates, I recommend to bin them separately first with the <code><a href="../reference/slice.html">slice()</a></code> function, rather than using the <code>age</code> argument of the <code><a href="../reference/divDyn.html">divDyn()</a></code> function. The integer bins can be used in any procedures, such as selectivity testing and subsampling, and you get better control over your calculations.</p>
<p>When time is fed to the <code>divDyn</code> function with its <code>bin</code> argument, it will assume by default that you are using discrete bins, with identifiers that increase as time passes by. On the other hand, using the <code>age</code> argument will assume that you use ages, with identifiers that decrease with flow of time. As the <code><a href="../reference/slice.html">slice()</a></code> function is designed to process age data, the way it handles time is similar to the <code>age</code> argument of the <code><a href="../reference/divDyn.html">divDyn()</a></code> function. You can override the default behavior in all by setting <code>revtime=TRUE</code>. <strong>In short: <code>bin</code> uses forward time, while <code>age</code> and <code><a href="../reference/slice.html">slice()</a></code> use backward time. </strong></p>
</div>
</div>
<div class="section level3">
<h3 id="origination-and-extinction-dates-in-binary-response-variables">4.4. Origination and extinction dates in binary response variables<a class="anchor" aria-label="anchor" href="#origination-and-extinction-dates-in-binary-response-variables"></a>
</h3>
<p>The occurrence dataset can be represented a taxon/bin matrix that taxa populate with presences or absences. Among the cells in this matrix, some mark the apparent origination or extinction dates of taxa. Two binary matrices can be outlined from this matrix: one for extinctions, and one for originations. Cells, where the taxa are assumed to be present are marked by 0s, and cells corresponding to the origination (or extinction) dates of taxa contains 1s (the rest are missing). Linearizing these matrices to binary vectors allows the application of statistical modelling techniques to infer which entries in additional variables are associated with the apparent origination and extinction events. You can transform the occurrence dataset to a data frame of such structure with the <code><a href="../reference/modeltab.html">modeltab()</a></code> function:</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># basic function call</span></span>
<span>  <span class="va">mtab</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/modeltab.html">modeltab</a></span><span class="op">(</span><span class="va">corals</span>, tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span><span class="op">)</span> </span>
<span>  <span class="va">mtab</span><span class="op">[</span><span class="va">mtab</span><span class="op">[</span>,<span class="st">"genus"</span><span class="op">]</span><span class="op">==</span><span class="st">"Acanthogyra"</span>,<span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##      ori   ext       genus stg</span></span>
<span><span class="co">## 8   TRUE FALSE Acanthogyra  67</span></span>
<span><span class="co">## 9  FALSE FALSE Acanthogyra  68</span></span>
<span><span class="co">## 10 FALSE FALSE Acanthogyra  69</span></span>
<span><span class="co">## 11 FALSE FALSE Acanthogyra  74</span></span>
<span><span class="co">## 12 FALSE  TRUE Acanthogyra  75</span></span></code></pre>
<p>The <code>ext</code> variable stands for extinctions and the <code>ori</code> column corresponds to originations. The basic output of the function only includes rows corresponding to the time bin/taxon matrix where the taxa are sampled. However, one could argue that intervals where the taxa are assumed to be present (although they are not sampled) are legitimate observations that they do not go extinct or originate. You can add these interpolated points by setting the <code>rt</code> argument of the function to <code>TRUE</code>:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># basic function call</span></span>
<span>  <span class="va">mtabrt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/modeltab.html">modeltab</a></span><span class="op">(</span><span class="va">corals</span>, tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span>, rt<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> </span>
<span>  <span class="va">mtabrt</span><span class="op">[</span><span class="va">mtabrt</span><span class="op">[</span>,<span class="st">"genus"</span><span class="op">]</span><span class="op">==</span><span class="st">"Acanthogyra"</span>,<span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##    occurrence   ori   ext       genus stg</span></span>
<span><span class="co">## 8        TRUE  TRUE FALSE Acanthogyra  67</span></span>
<span><span class="co">## 9        TRUE FALSE FALSE Acanthogyra  68</span></span>
<span><span class="co">## 10       TRUE FALSE FALSE Acanthogyra  69</span></span>
<span><span class="co">## 11      FALSE FALSE FALSE Acanthogyra  70</span></span>
<span><span class="co">## 12      FALSE FALSE FALSE Acanthogyra  71</span></span>
<span><span class="co">## 13      FALSE FALSE FALSE Acanthogyra  72</span></span>
<span><span class="co">## 14      FALSE FALSE FALSE Acanthogyra  73</span></span>
<span><span class="co">## 15       TRUE FALSE FALSE Acanthogyra  74</span></span>
<span><span class="co">## 16       TRUE FALSE  TRUE Acanthogyra  75</span></span></code></pre>
<p>Interpolated “occurrences” are marked with <code>FALSE</code> values in the <code>occurrence</code> variable of the output dataset. It is important to mention that this method is vulnerable to patterns of incomplete sampling, as the <code>rt</code> extension of ranges only uses interpolation, but no extrapolation.</p>
<p>Single-interval species require separate treatment as the <code>ext</code> and <code>ori</code> response cannot be anything else but <code>TRUE</code>. For this reason, these taxa are omitted by the function by default (<code>singletons=FALSE</code>). If you want to include these entries for some reason, you can do so by setting the <code>singletons</code> argument to <code>TRUE</code>.</p>
<p>Additional variables can be directly added by specifying the original column names of the taxon-specific entries (that have one to one agreement with the taxon entries defined in the <code>tax</code> ) as the <code>taxvars</code> argument of <code><a href="../reference/modeltab.html">modeltab()</a></code>:</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># function call with additional taxon-specific variables</span></span>
<span>  <span class="va">modTab</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/modeltab.html">modeltab</a></span><span class="op">(</span><span class="va">corals</span>, tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span>, </span>
<span>    rt<span class="op">=</span><span class="cn">TRUE</span>, taxvars<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ecology"</span>, <span class="st">"growth"</span><span class="op">)</span><span class="op">)</span> </span>
<span>  <span class="va">modTab</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##    occurrence   ori   ext        genus stg ecology   growth</span></span>
<span><span class="co">## 1        TRUE  TRUE FALSE Acanthastrea  89       z colonial</span></span>
<span><span class="co">## 2        TRUE FALSE FALSE Acanthastrea  90       z colonial</span></span>
<span><span class="co">## 3        TRUE FALSE FALSE Acanthastrea  91       z colonial</span></span>
<span><span class="co">## 4        TRUE FALSE FALSE Acanthastrea  92       z colonial</span></span>
<span><span class="co">## 5        TRUE FALSE FALSE Acanthastrea  93       z colonial</span></span>
<span><span class="co">## 6        TRUE FALSE FALSE Acanthastrea  94       z colonial</span></span>
<span><span class="co">## 7        TRUE FALSE  TRUE Acanthastrea  95       z colonial</span></span>
<span><span class="co">## 8        TRUE  TRUE FALSE  Acanthogyra  67       z colonial</span></span>
<span><span class="co">## 9        TRUE FALSE FALSE  Acanthogyra  68       z colonial</span></span>
<span><span class="co">## 10       TRUE FALSE FALSE  Acanthogyra  69       z colonial</span></span></code></pre>
<p>You are encouraged to use these structures as a framework for modelling the extinction and origination events by concatenating your own variables to this data.frame. Then you can use your preferred modelling technique, with calls such as:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">simpleMod</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">ext</span> <span class="op">~</span> <span class="va">ecology</span> <span class="op">+</span> <span class="va">growth</span>, family<span class="op">=</span><span class="st">"binomial"</span>, data<span class="op">=</span><span class="va">modTab</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="sampling-standardization">5. Sampling standardization<a class="anchor" aria-label="anchor" href="#sampling-standardization"></a>
</h2>
<div class="section level3">
<h3 id="concepts">5.1. Concepts<a class="anchor" aria-label="anchor" href="#concepts"></a>
</h3>
<div class="section level4">
<h4 id="the-goal-of-sampling-standardization">5.1.1. The goal of sampling standardization<a class="anchor" aria-label="anchor" href="#the-goal-of-sampling-standardization"></a>
</h4>
<p>Raw patterns of biodiversity are biased by heterogeneous, incomplete sampling. Consider the built-in example of the coral subset, where both the number of occurrences and the number of collections vary drastically over time.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sam</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/binstat.html">binstat</a></span><span class="op">(</span><span class="va">fossils</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, coll<span class="op">=</span><span class="st">"collection_no"</span>, duplicates<span class="op">=</span><span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html" class="external-link">cor.test</a></span><span class="op">(</span><span class="va">dd</span><span class="op">$</span><span class="va">divRT</span>, <span class="va">sam</span><span class="op">$</span><span class="va">occs</span>, method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in cor.test.default(dd$divRT, sam$occs, method = "spearman"): Cannot</span></span>
<span><span class="co">## compute exact p-value with ties</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Spearman's rank correlation rho</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  dd$divRT and sam$occs</span></span>
<span><span class="co">## S = 4708.8, p-value = 4.944e-05</span></span>
<span><span class="co">## alternative hypothesis: true rho is not equal to 0</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">##      rho </span></span>
<span><span class="co">## 0.589824</span></span></code></pre>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html" class="external-link">cor.test</a></span><span class="op">(</span><span class="va">dd</span><span class="op">$</span><span class="va">divSIB</span>, <span class="va">sam</span><span class="op">$</span><span class="va">occs</span>, method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in cor.test.default(dd$divSIB, sam$occs, method = "spearman"): Cannot</span></span>
<span><span class="co">## compute exact p-value with ties</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Spearman's rank correlation rho</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  dd$divSIB and sam$occs</span></span>
<span><span class="co">## S = 1453.9, p-value = 9.464e-14</span></span>
<span><span class="co">## alternative hypothesis: true rho is not equal to 0</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">##       rho </span></span>
<span><span class="co">## 0.8733499</span></span></code></pre>
<p>Sampling standardization allows the researcher to answer the question: would the patterns change, if sampling was homogeneous over time? There are two ways to answer this question: extrapolation and interpolation. Extrapolation methods try to infer on information we do not have. Interpolation methods, on the other hand, omit information to make sampling intensity comparable. The latter are more frequently employed in the paleontological context, and is usually referred to as ‘subsampling’, while the former has more robust applications when sampling is already quite extensive. Beware: as subsampling omits information, the result gained by subsampling is not an unequivocal substitute to the raw patterns, but rather their confirmation!</p>
</div>
<div class="section level4">
<h4 id="the-formal-representation-of-subsampling">5.1.2. The formal representation of subsampling<a class="anchor" aria-label="anchor" href="#the-formal-representation-of-subsampling"></a>
</h4>
<p>Although rarefaction is defined as a deterministic estimator, due to the advancement of computational speed, recent implementations of the process use Monte Carlo estimation to get expected results of the subsampling procedure. This just means that a random subset of a given size is taken from the data, the desired statistic (e.g. taxonomic richness) is calculated, and these steps are iterated. The omission of information effectively simulates lower levels of sampling (but conditioned on the realized sampling).</p>
<p>This general question ‘what would the pattern would be like?’ is not specific to estimators of richness, but is generalizable to all other statistics that depend on sampling intensity. If the result of this estimator (<em>Res</em>) is dependent on the information from the time slice, it is essentially just a function <em>f</em> of the data (<em>D</em>) at hand with potential additional arguments <em>argF</em>:</p>
<p><span class="math display">\[Res= f(D, argF).\]</span></p>
<p>The same metric can be calculated by using the subsampled data in the time slice, but first we have to calculate this set with the subsampling procedure. This is just another function g that outputs a subset of the input dataset, to which we will refer to as the ‘trial dataset’:</p>
<p><span class="math display">\[sub = g(D, argD)\]</span></p>
<p>Therefore, the metric in question in a trial is dependent on both the two functions and their additional arguments. We can generalize such an implementation of subsampling with the following notation:</p>
<p><span class="math display">\[f(g(D, argG), argF)\]</span></p>
<p>resulting in the <em>trial result</em>. However this only applies to simple estimates that only use information from a single bin (e.g. simple diversity metrics such as SIB). But most other metrics are dependent on multiple slices, which means that the function result can be formalized as</p>
<p><span class="math display">\[res = f(D1, D2,... Dn, argF).\]</span></p>
<p>In order to make sampling standardization work, the subsampling procedure has to be applied to every bin-specific datasets. This means that a single trial result will be</p>
<p><span class="math display">\[tri = f(g(D1, argG), g(D2, argG),..., g(Di, argG), argF) \]</span></p>
<p>As the trial result is the manifestation of the randomness in procedure g it has to be recalculated iteratively. In order to extract the expectation of this procedure, the results will also have to be averaged in some way, both of which are implemented in the <code><a href="../reference/subsample.html">subsample()</a></code> function. With this notation, the function f is the <em>applied function</em> which can be specified with the <code>FUN</code> argument, the g is the <em>subsampler</em> function, which includes predefined procedures (will be expanded so that the users can write custom procedures). The arguments <em>argF</em> and <em>argG</em> are the <em>applied</em> and <em>subsampling arguments</em> respectively. Naturally, you can use the function with different instances that have the same abstract representation. The basic arguments of subsampling are discussed in the next chapter.</p>
</div>
</div>
<div class="section level3">
<h3 id="basic-arguments">5.2. Basic arguments<a class="anchor" aria-label="anchor" href="#basic-arguments"></a>
</h3>
<p>Some arguments must be provided in order to make the function run. These will be demonstrated with the simplest, Classical Rarefaction method (CR, Raup, 1975). All other subsampling methods (see section ‘5.4. Different Subsampling Types) use these input parameters, but most of them will require additional arguments. In all cases, you will have to specify the input dataset, the column containing the categories (taxon names) and the binning variable, by which the data will be dissected to run the subsampler function. These are the <code>x</code>, <code>tax</code>, and <code>bin</code> arguments, respectively. As the function is expected to be used on Paleobiology Database data, the duplicates argument (see section below on this argument) is set to <code>FALSE</code> by default for quicker use in these cases. This necessitates the ‘coll’ argument that defines the column name of the collection identifiers, which is set to the database default <code>collection_no</code>. This variable designates samples in the occurrence dataset. If you do not have such samples, then set the duplicates argument to TRUE, which makes it possible to run the function without such a variable.</p>
<div class="section level4">
<h4 id="subsampling-level">5.2.1. Subsampling level<a class="anchor" aria-label="anchor" href="#subsampling-level"></a>
</h4>
<p>The only other mandatory input is the ‘level’ of subsampling, which can be specified using the <code>q</code> argument. The exact nature of this value is dependent on the subsampler function (see section ‘Different Subsampling Methods’), but in general it expresses sampling intensity. For the CR subsampling method, this argument represents the subsampling quota, the desired number of occurrences in the ‘trial datasets’. Increasing values will result in increasingly higher sampled diversities. The ‘q’ argument cannot be negative. With the subsampling quota of 40 and 60 occurrences the function outputs the following results for the coral dataset:</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># basic plot</span></span>
<span>  <span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>    ylab<span class="op">=</span><span class="st">"SIB diversity"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">200</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># raw diversity</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">dd</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"black"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># subsampling</span></span>
<span>  <span class="co"># with 40 occs.</span></span>
<span>  <span class="va">subCR40</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossils</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, q<span class="op">=</span><span class="fl">40</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">subCR40</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"blue"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="co"># with 80 occs.</span></span>
<span>  <span class="va">subCR80</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossils</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, q<span class="op">=</span><span class="fl">80</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">subCR80</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># legend</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"raw"</span>, <span class="st">"CR, q = 40"</span>,<span class="st">"CR, q = 80"</span><span class="op">)</span>,</span>
<span>    col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/ddCRBasic-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="the-number-of-iterationstrials">5.2.2. The number of iterations/trials<a class="anchor" aria-label="anchor" href="#the-number-of-iterationstrials"></a>
</h4>
<p>The precision of the simulations can be chosen by changing the number of iterations the function will run. This can set with the <code>iter</code> argument that has to be a single positive integer. In general, the more iterations, the better the results, but the time the function needs to run has a linear relationship with the iteration number. Most paleontological examples are stable after a couple hundred iterations. However, if the result of the function changes with every run, you will have to increase this number!</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># basic plot</span></span>
<span>  <span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>    ylab<span class="op">=</span><span class="st">"genus richness (corrected SIB)"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">200</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">dd</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"black"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">## subsampled, stable  </span></span>
<span>  <span class="va">subStab</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossils</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, iter<span class="op">=</span><span class="fl">100</span>, q<span class="op">=</span><span class="fl">30</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">subStab</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"blue"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">## subsampled, unstable  </span></span>
<span>  <span class="va">subInstab</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossils</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, iter<span class="op">=</span><span class="fl">5</span>, q<span class="op">=</span><span class="fl">30</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">subInstab</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># legend</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"raw"</span>, <span class="st">"CR, q=30, stable"</span>,</span>
<span>    <span class="st">"CR, q=30, unstable"</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>, </span>
<span>    lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/subIter-1.png" width="700"></p>
<p>In this example, the red line is based on only 5 iterations, while the blue one is based on 100. This typically means that the low iteration number will have similar trajectory to the other series, but will have more volatility due to the random sampling error.</p>
</div>
<div class="section level4">
<h4 id="the-duplicates-argument">5.2.3. The <code>duplicates</code> argument<a class="anchor" aria-label="anchor" href="#the-duplicates-argument"></a>
</h4>
<p>In the Paleobiology Database, occurrences are organized in collections, and are recorded as lists of taxa. These entries optimally are on the species-level of taxonomic resolution while most analyses operate at the level of genera. As multiple species can be registered in a single collection, the same genus name can appear multiple time in the collection list. This will have an effect on the occurrence-based subsampling methods. Using the <code>duplicates</code> arguments, you can toggle whether the surplus entries should be omitted (<code>duplicates=FALSE</code>, default) or whether they should be kept (<code>duplicates=TRUE</code>). The omission is applied to the variables defined in <code>tax</code> and <code>coll</code> variables. In case <code>duplicates=FALSE</code> the <code>coll</code> argument is mandatory.</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## subsampled, stable  </span></span>
<span>  <span class="va">subCRnd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossils</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, </span>
<span>    coll<span class="op">=</span><span class="st">"collection_no"</span>, iter<span class="op">=</span><span class="fl">100</span>, q<span class="op">=</span><span class="fl">40</span>, duplicates<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># basic plot</span></span>
<span>  <span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>    ylab<span class="op">=</span><span class="st">"number of occurrences"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">subCR40</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"blue"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">subCRnd</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"black"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CR, q=40 (with duplicates)"</span>,</span>
<span>    <span class="st">"CR, q=40"</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"black"</span><span class="op">)</span>, </span>
<span>    lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/subDupl-1.png" width="700"> This particular dataset actually contains multiple genus occurrences, so changing this argument to <code>FALSE</code> is justified. However, as it lengthens the function call considerably, the following examples will be based on data that already had this filtering step:</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># indicate identical collection/genus combinations</span></span>
<span><span class="va">collGenus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">fossils</span><span class="op">$</span><span class="va">collection_no</span>, <span class="va">fossils</span><span class="op">$</span><span class="va">genus</span><span class="op">)</span></span>
<span><span class="co"># omit the duplicates from the occurrence datasets</span></span>
<span><span class="va">fossGen</span> <span class="op">&lt;-</span> <span class="va">fossils</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html" class="external-link">duplicated</a></span><span class="op">(</span><span class="va">collGenus</span><span class="op">)</span>,<span class="op">]</span></span></code></pre></div>
<p>Just remember that this step can be skipped by adding <code>duplicates=FALSE</code> to the <code><a href="../reference/subsample.html">subsample()</a></code> function call.</p>
</div>
<div class="section level4">
<h4 id="the-usefailed-argument">5.2.4. The <code>useFailed</code> argument<a class="anchor" aria-label="anchor" href="#the-usefailed-argument"></a>
</h4>
<p>The subsampling level can be set as high as the user wants it to be. Depending on whether the data in the time slices reach the subsampling quota or not, the time slices can be included or excluded from the results. If the <code>useFailed</code> argument is set to <code>FALSE</code>, then the time slices that do not have enough information to reach the subsampling quota will be omitted from the resulting series. This is the default setting, and if the <em>applied function</em> output is a scalar or a vector, then the corresponding results will be omitted. If <code>useFailed=TRUE</code> then the bins where the quota is not reached will be represented in the <em>trial dataset</em> with all their sampled occurrences.</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># basic plot</span></span>
<span>  <span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>    ylab<span class="op">=</span><span class="st">"number of occurrences"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># subsampled, without failed  </span></span>
<span>  <span class="va">withoutFail</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, </span>
<span>    iter<span class="op">=</span><span class="fl">100</span>, q<span class="op">=</span><span class="fl">80</span>, useFailed<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">withoutFail</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"black"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># subsampled, with failed </span></span>
<span>  <span class="va">withFail</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, </span>
<span>    iter<span class="op">=</span><span class="fl">100</span>, q<span class="op">=</span><span class="fl">80</span>, useFailed<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">withFail</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"blue"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CR, q=80, without failed"</span>,</span>
<span>    <span class="st">"CR, q=100, with failed"</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"blue"</span><span class="op">)</span>, </span>
<span>    lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/subFail-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="the-keep-and-rem-arguments">5.2.5. The <code>keep</code> and <code>rem</code> arguments<a class="anchor" aria-label="anchor" href="#the-keep-and-rem-arguments"></a>
</h4>
<p>These arguments handle which bins should be forced to be kept (included) or removed (excluded) from the <em>trial dataset</em>. It accepts a numeric vector, with the bin identifiers. Positive entries mean that the bins will be included in the <em>trial dataset</em> without subsampling. This can be useful if you want the inclusion of recent ‘occurrences’ to demonstrate the ‘Pull of the Recent’ effect. This example uses the original <code>corals</code> dataset to demonstrate how the argument works (with duplicates omitted).</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># basic plot</span></span>
<span>  <span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>    ylab<span class="op">=</span><span class="st">"per capita extinction rates"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## subsampled, excluding the recent occurrences  </span></span>
<span>  <span class="va">sub</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">corals</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, iter<span class="op">=</span><span class="fl">100</span>, </span>
<span>    q<span class="op">=</span><span class="fl">50</span>, rem<span class="op">=</span> <span class="fl">95</span>, duplicates<span class="op">=</span><span class="cn">FALSE</span>, coll<span class="op">=</span><span class="st">"collection_no"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span>, <span class="va">sub</span><span class="op">$</span><span class="va">extPC</span>, col<span class="op">=</span><span class="st">"black"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">## subsampled, including the recent</span></span>
<span>  <span class="va">subPR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">corals</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, iter<span class="op">=</span><span class="fl">100</span>, </span>
<span>    q<span class="op">=</span><span class="fl">50</span>, keep<span class="op">=</span> <span class="fl">95</span>, duplicates<span class="op">=</span><span class="cn">FALSE</span>, coll<span class="op">=</span><span class="st">"collection_no"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span>, <span class="va">subPR</span><span class="op">$</span><span class="va">extPC</span>, col<span class="op">=</span><span class="st">"blue"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># legend</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"only fossils"</span>, </span>
<span>    <span class="st">"including the recent\n(not subsampled)"</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"blue"</span><span class="op">)</span>,</span>
<span>    lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/subIntact-1.png" width="700"></p>
<p>Between these two curves, neither shows perfectly accurate results. The per capita rates employ the range-through assumption. The first results (<code>sub</code>) is biased by edge effects, the closer the end of the time series is, the higher the rate values are due to decreasing total amount of range extensions. The inclusion of entries in the second dataset on the other hand allows the ‘Pull of the Recent’ to depress the extinction rates of the Late Cenozoic.</p>
</div>
<div class="section level4">
<h4 id="subsampling-output-and-plotting-options">5.2.6. Subsampling ‘output’ and plotting options<a class="anchor" aria-label="anchor" href="#subsampling-output-and-plotting-options"></a>
</h4>
<p>The output type of the subsampling process can be set with the output argument. This should be dependent on the further use of the function results. The most direct output is the arithmetic (default) or geometric means of the trials. They provide almost the same output:</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># basic plot</span></span>
<span>  <span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>    ylab<span class="op">=</span><span class="st">"richness of genera (corrected SIB)"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## arithmetic mean output</span></span>
<span>  <span class="va">subArit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, iter<span class="op">=</span><span class="fl">100</span>, q<span class="op">=</span><span class="fl">40</span>, output<span class="op">=</span><span class="st">"arit"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">subArit</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"black"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">## geometric mean output  </span></span>
<span>  <span class="va">subGeom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, </span>
<span>    iter<span class="op">=</span><span class="fl">100</span>, q<span class="op">=</span><span class="fl">40</span>, output<span class="op">=</span><span class="st">"geom"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">subGeom</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"blue"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"arithmetic means"</span>, <span class="st">"geometric means"</span><span class="op">)</span>,</span>
<span>    col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"blue"</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/subOutput-1.png" width="700"></p>
<p>However, the subsampling outputs demonstrate the natural variance arising from the simulating nature of the process. The results of the individual trials can be conserved by setting the output argument to either <code>"dist"</code> or <code>"list"</code>. The difference between these two options is that <code>dist</code> groups the results of the trials by the structure of the original function. In the cases when the <code><a href="../reference/divDyn.html">divDyn()</a></code> function is the <em>applied function</em> (every example until now), the output is a list, where all variables are matrices.</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## subsampled, dist output </span></span>
<span>  <span class="va">subDist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, </span>
<span>    iter<span class="op">=</span><span class="fl">100</span>, q<span class="op">=</span><span class="fl">40</span>, output<span class="op">=</span><span class="st">"dist"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the variables</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">subDist</span><span class="op">)</span></span>
<span><span class="co"># the dimensions of a single variable</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">subDist</span><span class="op">$</span><span class="va">divCSIB</span><span class="op">)</span></span></code></pre></div>
<p>Rows are time slices, while columns represent the individual trials. These can be visualized by a simple <code>for()</code> loop, and the arithmetic means can be calculated the regular way.</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>  ylab<span class="op">=</span><span class="st">"subsampled richness of genera (corrected SIB)"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">150</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plottedVar</span> <span class="op">&lt;-</span> <span class="va">subDist</span><span class="op">$</span><span class="va">divCSIB</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">plottedVar</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">plottedVar</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span>, col<span class="op">=</span><span class="st">"#00000099"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># the mean</span></span>
<span><span class="va">csibMeans</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">plottedVar</span>,<span class="fl">1</span>, <span class="va">mean</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">csibMeans</span> , col<span class="op">=</span><span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/subMultiRes-1.png" width="700"></p>
<p>For convenience, this variance can also be plotted with the new <code><a href="../reference/shades.html">shades()</a></code> function. That will display the distribution of values by drawing transparent polygons. The quantiles of each distribution are calculated, and the same values are then connected (.75 to .75).</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>  ylab<span class="op">=</span><span class="st">"subsampled richness of genera (corrected SIB)"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">150</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/shades.html">shades</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">plottedVar</span>, res<span class="op">=</span><span class="fl">10</span>, col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/shades-1.png" width="700"></p>
<p>Setting the <code>res</code> argument of this function controls the ‘quantile resolution’. The higher the number, the more refined the transparency gradient will be. However, it is more useful to the enter the exact quantiles to be plotted in the form of a numeric vector:</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>  ylab<span class="op">=</span><span class="st">"subsampled richness of genera (corrected SIB)"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">150</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/shades.html">shades</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">plottedVar</span>, col<span class="op">=</span><span class="st">"blue"</span>, res<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.25</span>,<span class="fl">0.75</span>,<span class="fl">0.95</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/shades100-1.png" width="700"></p>
<p>The function’s color argument only accepts colors that are specified without the alpha channel (for instance <code>"#00000066"</code> is impossible, but <code>"blue"</code> or <code>"#4433FF"</code> are perfectly viable).</p>
</div>
</div>
<div class="section level3">
<h3 id="the-applied-function-during-the-subsampling">5.3. The applied function during the subsampling<a class="anchor" aria-label="anchor" href="#the-applied-function-during-the-subsampling"></a>
</h3>
<p>By default, executing the <code><a href="../reference/subsample.html">subsample()</a></code> command on the occurrence data will run the <code><a href="../reference/divDyn.html">divDyn()</a></code> function in every iteration, which is specified by the <code>FUN</code> argument (function <em>f</em> in the notation above). Setting this argument to <code>NULL</code> will not run any function on the subsampled data subset of the trials (<em>trial data</em>). After all iterations are finished, the data subsets will be concatenated and the function will output them as a list of length <code>iter</code>. This option coerces the output type of the function to <code>list</code>, no other output type is possible.</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## subsampled </span></span>
<span><span class="va">subData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, </span>
<span>  iter<span class="op">=</span><span class="fl">100</span>, q<span class="op">=</span><span class="fl">40</span>,FUN<span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># characteristics</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">subData</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "list"</span></span></code></pre>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">subData</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "results" "failed"</span></span></code></pre>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">subData</span><span class="op">$</span><span class="va">results</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 100</span></span></code></pre>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># columns of the trial dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">subData</span><span class="op">$</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "genus"          "collection_no"  "family"         "abund_value"   </span></span>
<span><span class="co">##  [5] "abund_unit"     "reference_no"   "life_habit"     "diet"          </span></span>
<span><span class="co">##  [9] "country"        "geoplate"       "lat"            "lng"           </span></span>
<span><span class="co">## [13] "paleolat"       "paleolng"       "period"         "epoch"         </span></span>
<span><span class="co">## [17] "subepoch"       "stage"          "early_interval" "late_interval" </span></span>
<span><span class="co">## [21] "max_ma"         "min_ma"         "stg"            "ten"           </span></span>
<span><span class="co">## [25] "env"            "lith"           "latgroup"       "bath"          </span></span>
<span><span class="co">## [29] "gensp"          "ecology"        "ecologyMostZ"   "ecologyMostAZ" </span></span>
<span><span class="co">## [33] "ecologyBoth"    "growth"         "integration"    "mid"           </span></span>
<span><span class="co">## [37] "stgMid"         "mid_ma"         "slc"</span></span></code></pre>
<p>The advantage of this option is that you can inspect the results of the subsampling output. You can also iterate a custom function on this output by using the <code><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply()</a></code> interator in base R. The results of the function will be output as a <code>list</code>.</p>
<div class="section level4">
<h4 id="example-1-checking-the-number-of-occurrences">5.3.1. Example 1: Checking the number of occurrences<a class="anchor" aria-label="anchor" href="#example-1-checking-the-number-of-occurrences"></a>
</h4>
<p>One of the functions we can check is the number of occurrences in the ‘trial datasets’. By the rules of CR, this should be exactly <code>q</code>:</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">OCC</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">stg</span><span class="op">)</span></span>
<span><span class="co"># list of trials, each contains the number of occurrences in a bin (vector)</span></span>
<span><span class="va">subOccs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">subData</span><span class="op">$</span><span class="va">results</span>, <span class="va">OCC</span><span class="op">)</span></span>
<span><span class="co"># one trial</span></span>
<span><span class="va">subOccs</span> <span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 </span></span>
<span><span class="co">## 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 </span></span>
<span><span class="co">## 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 </span></span>
<span><span class="co">## 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40</span></span></code></pre>
<p>Extracting the central tendency (average of the trials) is more difficult this way, but some output structures (e.g. geographic shapes) might require special treatment that can be written as a custom function. Anyway, <code><a href="../reference/subsample.html">subsample()</a></code> allows the simplification of this process, if you set the output argument to ‘list’ and by providing the custom function as the <code>FUN</code> argument. One rule is that the function must take the occurrence dataset as an argument, which is formally called <code>x</code>:</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">OCC</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">stg</span><span class="op">)</span></span>
<span><span class="va">subOccsInternal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, </span>
<span>  iter<span class="op">=</span><span class="fl">100</span>, q<span class="op">=</span><span class="fl">40</span>,FUN<span class="op">=</span> <span class="va">OCC</span>, output<span class="op">=</span><span class="st">"list"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subOccsInternal</span><span class="op">$</span><span class="va">results</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 </span></span>
<span><span class="co">## 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40 </span></span>
<span><span class="co">## 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 </span></span>
<span><span class="co">## 40 40 40 40 40 40 40 40 40 40 40 40 40 40 40</span></span></code></pre>
<p>Whether averaging is possible will be dependent on the output of the <em>applied function</em>. If the output of the vector is scalar, then the output methods <code>"arit"</code> and <code>"geom"</code> will return a scalar, and <code>"dist"</code> will return a vector. If the output of the function is a vector, both <code>"arit"</code> and <code>"geom"</code> will return a single vector, and <code>"dist"</code> will return a matrix. If the result of the <em>applied function</em> is a <code>data.frame</code>, then the result of <code>"arit"</code> and <code>"geom"</code> will be a <code>data.frame</code> (from the result) too. In this case, if the output is <code>"dist"</code>, then the output of the subsample function will be a <code>list</code>, each of its elements representing one of the variables in the output of the <em>applied function</em>, but instead of containing vectors, they will contain matrices. This is the case for the <code><a href="../reference/divDyn.html">divDyn()</a></code> function. Running the function <code>OCC()</code> above with the <code>"dist"</code> type output will produce a matrix of occurrences:</p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subDistOccs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, </span>
<span>  iter<span class="op">=</span><span class="fl">100</span>, q<span class="op">=</span><span class="fl">40</span>,FUN<span class="op">=</span> <span class="va">OCC</span>, output<span class="op">=</span><span class="st">"dist"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">subDistOccs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  int [1:41, 1:100] 40 40 40 40 40 40 40 40 40 40 ...</span></span>
<span><span class="co">##  - attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##   ..$ : chr [1:41] "54" "55" "56" "57" ...</span></span>
<span><span class="co">##   ..$ : NULL</span></span></code></pre>
<p>Note the dimensions of the matrix, which is <code>41</code> times <code>100</code>, the number of sampled time slices and the number of subsampling trials. CAUTION: The averaging and the grouping of the resulting variables is possible because the <em>applied function</em> is run on the total dataset first, which will result in a container prototype that is used to store the <em>trial results</em>. If the function output structure (i.e. dimensions) is different when it is run for the subsets than when it is run on the total dataset, the subsample function will output an error.</p>
</div>
<div class="section level4">
<h4 id="example-2-maximum-absolute-paleolatitudes">5.3.2. Example 2: maximum absolute paleolatitudes<a class="anchor" aria-label="anchor" href="#example-2-maximum-absolute-paleolatitudes"></a>
</h4>
<p>Let’s say you are interested in the maximum absolute paleolatitude of the occurrences. This will be influenced by the number of occurrences, and should therefore be rechecked with subsampling. You can calculate this in the raw dataset with the following function, using the known variable names:</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PL</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">tRes</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span>INDEX<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">stg</span>, X<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">paleolat</span>, FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">tRes</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">maxPaLat</span><span class="op">&lt;-</span> <span class="fu">PL</span><span class="op">(</span><span class="va">fossils</span><span class="op">)</span></span></code></pre></div>
<p>This variable certainly increases with age,</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html" class="external-link">cor.test</a></span><span class="op">(</span><span class="va">maxPaLat</span>, <span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">54</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Spearman's rank correlation rho</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  maxPaLat and stages$mid[54:94]</span></span>
<span><span class="co">## S = 18336, p-value = 5.307e-05</span></span>
<span><span class="co">## alternative hypothesis: true rho is not equal to 0</span></span>
<span><span class="co">## sample estimates:</span></span>
<span><span class="co">##        rho </span></span>
<span><span class="co">## -0.5972125</span></span></code></pre>
<p>but it is questionable at this point, whether the increasing number of occurrences is responsible for this pattern, or whether you would still see it, if the same number of occurrences were sampled from each time slice. You can quickly check this association at 20 occurrences and CR by running:</p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subMaxPaLat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, </span>
<span>  iter<span class="op">=</span><span class="fl">100</span>, q<span class="op">=</span><span class="fl">20</span>,FUN<span class="op">=</span><span class="va">PL</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>  ylab<span class="op">=</span><span class="st">"maximum sampled paleolatitude"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">90</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">54</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">maxPaLat</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">54</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">subMaxPaLat</span>, col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span>
<span><span class="co"># legend</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"max"</span>,</span>
<span>  <span class="st">"subsampled max"</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>,<span class="st">"black"</span><span class="op">)</span>,</span>
<span>  bg<span class="op">=</span><span class="st">"white"</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/subPLSmm-1.png" width="700"></p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html" class="external-link">cor.test</a></span><span class="op">(</span><span class="va">subMaxPaLat</span>, <span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">54</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, method<span class="op">=</span><span class="st">"spearman"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="different-subsampling-types">5.4. Different subsampling types<a class="anchor" aria-label="anchor" href="#different-subsampling-types"></a>
</h3>
<div class="section level4">
<h4 id="classical-rarefaction-cr">5.4.1. Classical Rarefaction (CR)<a class="anchor" aria-label="anchor" href="#classical-rarefaction-cr"></a>
</h4>
<p>Classical Rarefaction is the most straightforward subsampling method. It is based on the assumption that the number of occurrences is a direct proxy for sampling intensity. Although this assumption can be criticized (see below), the general applicability of the method, and straightforward interpretation of the results makes it especially useful for checking the distorting effects of sampling. The arguments of the subsampling types are summarized at the help page of the subsampling trial functions (5.4.4.). The traditional classical rarefaction procedure was expanded to perform unit-based subsampling. In all cases above, CR used the number of rows within a bin as the units of the subsampling procedure which is set by the default argument <code>unit=NULL</code>. However, the calculation can also be run with multiple rows describing one unit (list) of the subsampling that is indicated by another variable. This way you can rarefy the data to a certain number of collections (UW subsampling, see below), references or whatever, while the all rows forming the units remain intact.</p>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subUWunit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, </span>
<span>  iter<span class="op">=</span><span class="fl">100</span>, q<span class="op">=</span><span class="fl">10</span>, type<span class="op">=</span><span class="st">"cr"</span>, unit<span class="op">=</span><span class="st">"collection_no"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="occurrence-weighted-by-list-subsampling-oxw">5.4.2. Occurrence-weighted by-list subsampling (O<sup>x</sup>W)<a class="anchor" aria-label="anchor" href="#occurrence-weighted-by-list-subsampling-oxw"></a>
</h4>
<p>By-list subsampling methods use information about how the occurrences are clustered in lists. In the PaleoDB, these clusters are the collections that ‘contain’ the occurrences, which are direct products of sampling. Depending on whether we would like to emphasize the sampling of collections (related to beta diversity) or the number of entries in lists, you can use the O<sup>x</sup>W group of subsampling (Alroy et al., 2001). Since the development of SQS (or CBR, see below) these methods have not been widely applied, but nevertheless, they could be useful in some projects. The basis of these methods is that collection integrity cannot be broken during the subsampling procedure. Entire lists are drawn from the subsampling pool of each time bin, while the number of occurrences are tracked. These lists are the collections that should be indicated by setting the <code>coll</code> variable appropriately. When the quota is reached, no more occurrences are drawn. The rest of the process (assembly of the <em>trial dataset</em>, running the <em>applied function</em>) is the same as with the CR method.</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subOW</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, coll<span class="op">=</span><span class="st">"collection_no"</span>,</span>
<span>  iter<span class="op">=</span><span class="fl">100</span>, q<span class="op">=</span><span class="fl">40</span>, type<span class="op">=</span><span class="st">"oxw"</span><span class="op">)</span></span></code></pre></div>
<p>The output of the occurrence-weighted (OW) type is typically very close to the output of the corresponding level CR results:</p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subCR</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, iter<span class="op">=</span><span class="fl">100</span>, q<span class="op">=</span><span class="fl">40</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>  ylab<span class="op">=</span><span class="st">"corrected SIB diversity"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">90</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">subCR</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">subOW</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CR - 40"</span>, <span class="st">"OW - 40"</span><span class="op">)</span>, </span>
<span>  col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"blue"</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/subOW-1.png" width="700"></p>
<p>The reason why the method type is called the O<sup>x</sup>W is because, depending on the relative importance of the collections and the entries within the collection, lists express different aspects of sampling. This can be taken into consideration with the exponentiation of the occurrence counts in each collection. In these procedures, the number of occurrences in each collection will be raised to the power of <code>xexp</code> and the sum of the resulting values will be compared to the set subsampling quota. The simplest way of doing this is to raise the number of occurrences in a collection to the power of 0, which effectively means the selection of a certain number of collections in all different time slices (no matter how many occurrences there are in a collection it will be 1 if raised to the power of 0). Setting the <code>xexp</code> argument to 0, will force this setting. This is sometimes referred to as the ‘unweighted subsampling’ method, which effectively means to subsample the data to a certain number of collections in a bin. In this case the <code>q</code> argument will represent the quota of collections.</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trialsUW</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, coll<span class="op">=</span><span class="st">"collection_no"</span>,</span>
<span>  iter<span class="op">=</span><span class="fl">100</span>, q<span class="op">=</span><span class="fl">20</span>, type<span class="op">=</span><span class="st">"oxw"</span>, xexp<span class="op">=</span><span class="fl">0</span>, FUN<span class="op">=</span><span class="va">binstat</span><span class="op">)</span></span>
<span><span class="co"># the number of sampled collections on average in each timeslice</span></span>
<span><span class="va">trialsUW</span><span class="op">[</span><span class="fl">54</span><span class="op">:</span><span class="fl">94</span>, <span class="st">"colls"</span><span class="op">]</span></span>
<span><span class="va">subUW</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, coll<span class="op">=</span><span class="st">"collection_no"</span>,</span>
<span>  iter<span class="op">=</span><span class="fl">100</span>, q<span class="op">=</span><span class="fl">10</span>, type<span class="op">=</span><span class="st">"oxw"</span>, xexp<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>By this principle, it is not difficult to see that depending on the size of the collections, the actual number of occurrences will be somewhat higher than the quota. You can quickly check the exact number of occurrences drawn with the <code><a href="../reference/binstat.html">binstat()</a></code> function</p>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subST</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, coll<span class="op">=</span><span class="st">"collection_no"</span>, </span>
<span>  iter<span class="op">=</span><span class="fl">100</span>, q<span class="op">=</span><span class="fl">20</span>,FUN<span class="op">=</span><span class="va">binstat</span>, type<span class="op">=</span><span class="st">"oxw"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subST</span><span class="op">[</span><span class="fl">54</span><span class="op">:</span><span class="fl">94</span>, <span class="st">"occs"</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] 22.97 22.55 24.87 24.47 25.01 23.08 21.75 24.99 22.01 23.47 22.90 26.94</span></span>
<span><span class="co">## [13] 22.97 26.17 27.71 29.13 23.99 25.55 25.92 28.56 27.65 26.03 28.37 22.75</span></span>
<span><span class="co">## [25] 25.94 26.55 25.38 23.76 22.63 25.55 22.34 23.13 22.78 26.53 26.23 25.43</span></span>
<span><span class="co">## [37] 28.26 23.79 24.80 26.02 24.37</span></span></code></pre>
<p>Although there are ways to improve the accuracy of the subsampling process, the variation induced by this problem is only minuscule compared to those introduced by sampling and binning uncertainties. However, typically this <code>xexp</code> value is set to a value between 1 and 2 (e.g. 1.4). In these cases, you have to calculate the intensity of sampling . Although there is some discrepancy between the methods, the overall trajectories are quite similar.</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subO2W</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, coll<span class="op">=</span><span class="st">"collection_no"</span>, </span>
<span>  iter<span class="op">=</span><span class="fl">100</span>, q<span class="op">=</span><span class="fl">80</span>, type<span class="op">=</span><span class="st">"oxw"</span>, xexp<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>  ylab<span class="op">=</span><span class="st">"corrected SIB genus richness"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">90</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">subCR</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">subOW</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">subUW</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">subO2W</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"green"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CR - 40"</span>, <span class="st">"OW - 40"</span>, <span class="st">"UW - 10"</span>, <span class="st">"O2W - 80"</span><span class="op">)</span>,</span>
<span>  col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span>, <span class="st">"green"</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/subO2-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="shareholder-quorum-subsampling-sqs">5.4.3. Shareholder Quorum Subsampling (SQS)<a class="anchor" aria-label="anchor" href="#shareholder-quorum-subsampling-sqs"></a>
</h4>
<p>As intuitive as the CR approach is to understand, the method has been criticized for being ‘unfair’ (Alroy, 2010). The results of CR will not reflect changes of richness appropriately, if two localities with different diversities are compared and their total richnesses are not equal. This can be visualized by progressively lowering the subsampling quota for CR, which will result in not just decreased levels of richness but also in a pronounced decrease in variance (Alroy, 2010b). This effect can be illustrated by rerunning CR iteratively with progressively lower quotas.</p>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># repeat CR subsampling for a set of quotas</span></span>
<span><span class="va">quotas</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">70</span>,<span class="fl">10</span>,<span class="op">-</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">quotas</span><span class="op">)</span><span class="op">{</span></span>
<span>   <span class="co"># actual CR </span></span>
<span>   <span class="va">cr</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, iter<span class="op">=</span><span class="fl">50</span>, q<span class="op">=</span><span class="va">i</span>,tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span>, </span>
<span>    useFailed<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="co"># store output</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"cr"</span>, <span class="va">i</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span>, <span class="va">cr</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The code above reruns the CR algorithm on the dataset with 70, 60, 50 … and 10 occurrences as the quota of the subsampling. Then the results can be plotted with:</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>  ylab<span class="op">=</span><span class="st">"corrected SIB richness"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">90</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">quotas</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">current</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"cr"</span>, <span class="va">i</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">current</span> <span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/subCRmanyShow-1.png" width="700"></p>
<p>As the subsampling quota decreases, so does the mean value of richness, and also the relative deviation of the series. The Shareholder Quorum subsampling approach (Alroy, 2010) effectively circumvents this problem by using a different proxy for sampling completeness, other than the number of occurrences. Rather than looking at the basic unary information of occurrences, the SQS method assesses sampling with frequency coverage. Coverage is an intuitive way to express the completeness of sampling. In the species sampling pool all species have a frequency (F<sup>k</sup>) that sum up to 1. In this sense, the coverage of a sample is the sum of species frequencies in the original sampling pool (F<sup>k</sup>), but only for those species that actually have been sampled. This rule effectively coerces sampling coverage between 0 and 1. Different levels of sampling can be created by maximizing the desired coverage of a sample. This desired coverage is referred to as the ‘quorum’. After the work of Chao and Jost (2012), ecologists usually refer to this approach as coverage-based rarefaction.</p>
<div class="section level5">
<h5 id="the-inexact-approach-to-sqs">5.4.3.1. The ‘inexact’ approach to SQS<a class="anchor" aria-label="anchor" href="#the-inexact-approach-to-sqs"></a>
</h5>
<p>The original description of the SQS algorithm ensured different levels of coverages by going through the occurrences (or collections) randomly and aggregating the estimated frequencies of the species that are taken from the sample until this sum reached the subsampling quorum. John Alroy (2014) referred to this approach as the ‘inexact’ method to perform SQS. This is the default way to do SQS.</p>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># sqs with 0.6 quorum</span></span>
<span><span class="va">sqs0.6</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, iter<span class="op">=</span><span class="fl">50</span>, q<span class="op">=</span><span class="fl">0.6</span>,</span>
<span>  tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span>,  type<span class="op">=</span><span class="st">"sqs"</span><span class="op">)</span></span>
<span><span class="co">#sqs with 0.3 quorum</span></span>
<span><span class="va">sqs0.3</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, iter<span class="op">=</span><span class="fl">50</span>, q<span class="op">=</span><span class="fl">0.3</span>,</span>
<span>  tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span>, type<span class="op">=</span><span class="st">"sqs"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plotting</span></span>
<span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>  ylab<span class="op">=</span><span class="st">"corrected SIB richness"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">175</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">sqs0.6</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">sqs0.3</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"green"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">dd</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"raw"</span>, <span class="st">"SQS, q=0.6"</span>, <span class="st">"SQS, q=0.3"</span><span class="op">)</span>,</span>
<span>  col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/sqs1-1.png" width="700"> This procedure is dependent on the proper estimation of the species’ frequencies in the sampling pool (?frequencies). Alroy (2010) suggested that the observed frequencies should be adjusted with Good’s total sample coverage estimator <em>u</em>, which is dependent on the number of occurrences (<em>o</em>) and the number of single-collection (single-occurrence) taxa (<em><sup>1</sup>O </em>).</p>
<p><span class="math display">\[u = 1 - {1}O/o\]</span></p>
<p>This is the first correction of Alroy (2010, for overall coverage). He also suggested that for Paleobiology Database occurrences, a different version of this estimator (<em>u’</em>) might be more accurate that is estimated using the single reference taxa, instead of single-collection taxa. This estimator is then used to estimate the true frequencies of species. You can choose between these versions by toggling the <code>singleton</code> argument between <code>"occ"</code> (default), <code>"ref"</code> and it can be switched off by setting it to <code>FALSE</code>. Note that <code>"ref"</code> will require you to provide a reference variable (<code>ref</code> argument). The discrepancy between the methods is very small:</p>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sqsCollSing</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, iter<span class="op">=</span><span class="fl">50</span>, q<span class="op">=</span><span class="fl">0.4</span>, </span>
<span>  tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span>, type<span class="op">=</span><span class="st">"sqs"</span>, </span>
<span>  singleton<span class="op">=</span><span class="st">"occ"</span><span class="op">)</span></span>
<span><span class="va">sqsRefSing</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, iter<span class="op">=</span><span class="fl">50</span>, q<span class="op">=</span><span class="fl">0.4</span>,</span>
<span>  tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span>, type<span class="op">=</span><span class="st">"sqs"</span>, ref<span class="op">=</span><span class="st">"reference_no"</span>,</span>
<span>  singleton<span class="op">=</span><span class="st">"ref"</span><span class="op">)</span></span>
<span><span class="va">sqsNoSing</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, iter<span class="op">=</span><span class="fl">50</span>, q<span class="op">=</span><span class="fl">0.4</span>,</span>
<span>  tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span>, type<span class="op">=</span><span class="st">"sqs"</span>, singleton<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plotting</span></span>
<span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>  ylab<span class="op">=</span><span class="st">"corrected SIB richness"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">sqsRefSing</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">sqsCollSing</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">sqsNoSing</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SQS, q=0.4"</span>, <span class="st">"SQS, q=0.4, ref"</span>, <span class="st">"SQS, q=0.4, occ"</span><span class="op">)</span>,</span>
<span>  col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"blue"</span>, <span class="st">"red"</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/sqs2-1.png" width="700"> Alroy (2010) also mentioned two additional corrections (for <em>Evenness and Dominance</em> and <em>Single large collections</em>) that also have minor effects on the overall results. You can use the <code>excludeDominant</code> and <code>largestColl</code> arguments to turn these on. Note that you have to provide a collection variable to make <code>largestColl</code> work, which is only available if <code>excludeDominant=TRUE</code>.</p>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sqsPure</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, iter<span class="op">=</span><span class="fl">50</span>, q<span class="op">=</span><span class="fl">0.5</span>,</span>
<span>  tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span>, type<span class="op">=</span><span class="st">"sqs"</span><span class="op">)</span></span>
<span><span class="va">sqsCorr</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, iter<span class="op">=</span><span class="fl">50</span>, q<span class="op">=</span><span class="fl">0.5</span>,</span>
<span> tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span>, ref<span class="op">=</span><span class="st">"reference_no"</span>,coll<span class="op">=</span><span class="st">"collection_no"</span>,</span>
<span> type<span class="op">=</span><span class="st">"sqs"</span>, singleton<span class="op">=</span><span class="st">"ref"</span>, excludeDominant<span class="op">=</span><span class="cn">T</span>, largestColl<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plotting</span></span>
<span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>  ylab<span class="op">=</span><span class="st">"corrected SIB richness"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">sqsPure</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">sqsCorr</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"uncorrected SQS"</span>, </span>
<span>  <span class="st">"corrected SQS"</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"black"</span><span class="op">)</span>, </span>
<span>  lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/sqs3-1.png" width="700"></p>
<p>So far, these calculations were based on occurrence-based rarefaction, but SQS can be calculated similarly to OW, by tallying the occurrences collection-by-collection. This can be enforced with the <code>byList=TRUE</code> option.</p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sqsByColl</span> <span class="op">&lt;-</span><span class="fu"><a href="../reference/subsample.html">subsample</a></span><span class="op">(</span><span class="va">fossGen</span>, iter<span class="op">=</span><span class="fl">50</span>, q<span class="op">=</span><span class="fl">0.5</span>,</span>
<span> tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span>, ref<span class="op">=</span><span class="st">"reference_no"</span>,coll<span class="op">=</span><span class="st">"collection_no"</span>,</span>
<span> type<span class="op">=</span><span class="st">"sqs"</span>, singleton<span class="op">=</span><span class="st">"ref"</span>, excludeDominant<span class="op">=</span><span class="cn">T</span>, largestColl<span class="op">=</span><span class="cn">T</span>, byList<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plotting</span></span>
<span><span class="fu"><a href="../reference/tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fl">52</span><span class="op">:</span><span class="fl">95</span>,</span>
<span>  ylab<span class="op">=</span><span class="st">"corrected SIB richness"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">sqsByColl</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">94</span><span class="op">]</span>, <span class="va">sqsCorr</span><span class="op">$</span><span class="va">divCSIB</span>, col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"by-list SQS"</span>, </span>
<span>  <span class="st">"by-occurrence SQS"</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"black"</span><span class="op">)</span>, </span>
<span>  lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></code></pre></div>
<p><img src="divDyn_2_handout_files/figure-html/sqsColl-1.png" width="700"></p>
</div>
<div class="section level5">
<h5 id="concluding-remarks-on-sqs">5.4.3.2. Concluding remarks on SQS<a class="anchor" aria-label="anchor" href="#concluding-remarks-on-sqs"></a>
</h5>
<p>SQS is probably the most appropriate method we have today for sampling standardization of diversity curves. Although the number of potential influencing factors is high, they do not influence the overall trajectory of the curves, and the induced variation is almost equal to the variability that is created by subsampling itself (plot some results with <code>output="dist"</code>). The systematical evaluation of these options is still lacking, but we are working on the appropriate testing framework.</p>
</div>
</div>
<div class="section level4">
<h4 id="subsampling-trial-functions">5.4.4. Subsampling trial functions<a class="anchor" aria-label="anchor" href="#subsampling-trial-functions"></a>
</h4>
<p>The different subsampling types can be contrasted by comparing the subsampling trial functions (<code><a href="../reference/subtrial.html">subtrialCR()</a></code>, <code><a href="../reference/subtrial.html">subtrialOXW()</a></code> and <code><a href="../reference/subtrial.html">subtrialSQS()</a></code>).The procedures are of these functions are also implemented within the <code><a href="../reference/subsample.html">subsample()</a></code> function, and they can be used to produce one ‘trial dataset’ from the total sampled data. The output of these function is a logical vector indicating the rows of the data that should be present in one particular trial dataset. Future versions of the package will allow the writing and application of custom subsampling trial functions, with which the <code><a href="../reference/subsample.html">subsample()</a></code> function will be entirely customizable.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="taxon-specific-characteristics">6. Taxon-specific characteristics<a class="anchor" aria-label="anchor" href="#taxon-specific-characteristics"></a>
</h2>
<div class="section level3">
<h3 id="environmental-affinities">6.1. Environmental affinities<a class="anchor" aria-label="anchor" href="#environmental-affinities"></a>
</h3>
<p>Most taxa prefer certain environments. Our understanding of environmental affinities of different taxa depend on the characteristics of sampling. In some questions the definition of two contrasting environments suffices, and most hypotheses can be tested with univariate statistics between two samples. Using the most basic logic, one could infer that a taxon preferred environment <em>A</em> to environment <em>B</em>, all other things being equal, if it occurs more in that particular environment over its lifetime. This is sometimes referred to as the majority rule of affinity, and is very straightforward to implement. In our test example, a number of variables are added based on the raw data, which express the environmental conditions of the dataset. For the sake of demonstration, the bathymetric affinities <code>bath</code> will be calculated. First, we have to omit those occurrences that have unknown depth conditions.</p>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">knownBath</span> <span class="op">&lt;-</span> <span class="va">fossils</span><span class="op">[</span><span class="va">fossils</span><span class="op">$</span><span class="va">bath</span><span class="op">!=</span><span class="st">"uk"</span>,<span class="op">]</span></span></code></pre></div>
<div class="section level4">
<h4 id="majority-rule">6.1.1. Majority rule<a class="anchor" aria-label="anchor" href="#majority-rule"></a>
</h4>
<p>After this simple filtering, the <code><a href="../reference/affinity.html">affinity()</a></code> function can be applied to the dataset, with specifying the usual arguments, plus the <code>"majority"</code> method. The function also needs to be notified about the column (its name. <code>env="bath"</code> in our case) that contains the binary environmental variable in question:</p>
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">affMajor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/affinity.html">affinity</a></span><span class="op">(</span><span class="va">knownBath</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, </span>
<span>  method<span class="op">=</span><span class="st">"majority"</span>, coll<span class="op">=</span><span class="st">"collection_no"</span>, env<span class="op">=</span><span class="st">"bath"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">affMajor</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## affMajor</span></span>
<span><span class="co">## deep shal </span></span>
<span><span class="co">##   25  693</span></span></code></pre>
<p>The output of this function is a single character vector, values specifying the apparently preferred environments and the <code>names</code> attribute defining the taxon names. <code>NA</code> entries occur when the function is unable to define an affinity (i.e. the number of occurrences from both environments is the same). It is not mandatory to provide collection identifiers (<code>coll</code>). If these are given, then the multiple occurrences of a taxon within a collection (sample) will be treated as one. As you can see, an overwhelming majority of the taxa have shallow affinities based on this method, but this is not surprising, as most of the occurrences come from shallow environments.</p>
<div class="sourceCode" id="cb131"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">knownBath</span><span class="op">$</span><span class="va">bath</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  deep  shal </span></span>
<span><span class="co">##  1035 25644</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="binomial-method">6.1.2. Binomial method<a class="anchor" aria-label="anchor" href="#binomial-method"></a>
</h4>
<p>If sampling is so dominated by shallow occurrences, then the obvious question that arises is whether the apparent pattern of affinity only is present because this biased sampling. In order to correct for this ‘background’ sampling issue, Foote (2006) suggested that the environment affinity should be determined by comparing the taxon’s observed pattern of occurrences to that present in the total dataset (null sampling probability of the environment). This approach was also used by Kiessling and Aberhan (2007) and Kiessling and Kocsis (2015) in later studies. The sampling probability of the environment is calculated by taking the proportion of occurrences in the two environments in the total dataset from the range of the taxon. Under random sampling conditions, the number of total occurrences and the number among these that come from an environment is modelled by a binomial distribution. Given a certain level of confidence one can guess whether the sampled occurrences of a taxon represent a significantly higher or lower proportion than predicted by the null probability. The more likely it is that a simple binomial model can produce the observed success/total trial ratio, the less we know about the affinity of the taxon. This approach is implemented by the default <code>"binom"</code> method.</p>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">affBin1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/affinity.html">affinity</a></span><span class="op">(</span><span class="va">knownBath</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, </span>
<span>  method<span class="op">=</span><span class="st">"binom"</span>, coll<span class="op">=</span><span class="st">"collection_no"</span>, env<span class="op">=</span><span class="st">"bath"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">affBin1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## affBin1</span></span>
<span><span class="co">## deep shal </span></span>
<span><span class="co">##  135  574</span></span></code></pre>
<p>The significance of the binomial tests can be chosen by the <code>alpha</code> argument that toggles the breadth of proportions that is considered to be output by the randomness of sampling. The default <code>alpha = 1</code> setting (above) will not perform the binomial test. It will only compare the taxon’s observed proportion of occurrences from the different environments to those observed in the total dataset. The lower this <code>alpha</code> value is, the less taxa will get an assigned affinity.</p>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">affBin0.5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/affinity.html">affinity</a></span><span class="op">(</span><span class="va">knownBath</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, </span>
<span>  method<span class="op">=</span><span class="st">"binom"</span>, coll<span class="op">=</span><span class="st">"collection_no"</span>, env<span class="op">=</span><span class="st">"bath"</span>, alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">affBin0.5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## affBin0.5</span></span>
<span><span class="co">## deep shal </span></span>
<span><span class="co">##  127  149</span></span></code></pre>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">affBin0.1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/affinity.html">affinity</a></span><span class="op">(</span><span class="va">knownBath</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, </span>
<span>  method<span class="op">=</span><span class="st">"binom"</span>, coll<span class="op">=</span><span class="st">"collection_no"</span>, env<span class="op">=</span><span class="st">"bath"</span>, alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">affBin0.1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## affBin0.1</span></span>
<span><span class="co">## deep shal </span></span>
<span><span class="co">##   77   56</span></span></code></pre>
<p>Using the standard 95% percent as alpha level is an arbitrary choice. As the fossil record has quality issues, a 90% confidence (<code>alpha = 0.1</code>) is preferred in most cases. It is also possible to do the calculations based on the collection counts, instead of the number of occurrences. For these the argument <code>bycoll</code> has to be set to <code>TRUE</code>.</p>
</div>
</div>
<div class="section level3">
<h3 id="changing-characteristics">6.2. Changing characteristics<a class="anchor" aria-label="anchor" href="#changing-characteristics"></a>
</h3>
<p>The entire occurrence dataset can be subdivided into time-bin and taxon-specific subsets. We can use each of these subsets to describe the taxa’s ecological characteristics if we assert that these occurrences are contemporaneous.</p>
<div class="section level4">
<h4 id="geographic-range">6.2.1. Geographic range<a class="anchor" aria-label="anchor" href="#geographic-range"></a>
</h4>
<p>One of the most ecologically relevant characteristics of a taxon is its total geographic range, which can be calculated with the <code>georanges()</code> function, using a number of methods. These rely on the geographic coordinates of the occurrences, which are in this case reconstructed internally by the Paleobiology Database (with GPlates). This function is applicable to time-slice-specific subset of a single taxon, such as the Pleistocene occurrences of the genus <em>Acropora</em></p>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oneTax</span> <span class="op">&lt;-</span> <span class="va">corals</span><span class="op">[</span><span class="va">corals</span><span class="op">$</span><span class="va">stg</span><span class="op">==</span><span class="fl">94</span> <span class="op">&amp;</span> <span class="va">corals</span><span class="op">$</span><span class="va">genus</span><span class="op">==</span><span class="st">"Acropora"</span>,<span class="op">]</span> </span>
<span><span class="fu"><a href="../reference/georange.html">georange</a></span><span class="op">(</span><span class="va">oneTax</span>, lat<span class="op">=</span><span class="st">"paleolat"</span>, lng<span class="op">=</span><span class="st">"paleolng"</span>, method<span class="op">=</span><span class="st">"co"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  co </span></span>
<span><span class="co">## 213</span></span></code></pre>
<p>This function call outputs coordinate occupancy, the number of unique pairs of coordinates the taxon has. Besides this very simple one, multiple additional methods are available by calling functions from the <code>icosa</code> and <code>vegan</code> packages. You can inspect these with <code><a href="../reference/georange.html">?georange</a></code>.</p>
</div>
<div class="section level4">
<h4 id="the-tabinate-iterator-function">6.2.2. The <code>tabinate()</code> iterator function<a class="anchor" aria-label="anchor" href="#the-tabinate-iterator-function"></a>
</h4>
<p>For large-scale analyses of taxa, it is desirable to apply the function above to all time-bin/taxon specific subsets of the data. This can be desired for numerous calculations that use contemporaneous occurrences of a taxon as input, which can be iterated for every time-bin/taxon subset with the <code><a href="../reference/tabinate.html">tabinate()</a></code> function. To use this function you have to provide the taxon and time bin identifiers (<code>tax</code> and <code>bin</code>, respectively), and the function (<code>FUN</code>) that needs to be iterated on every taxon/time-bin subset of the dataset. This function has to take <code>x</code> as the primary argument (the database subset), but additional arguments will be passed to it.</p>
<p>For instance, if you are interested in the number of collections each taxon has in each time slice, instead of using a combination of functions (<code><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset()</a></code>, <code><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique()</a></code> and <code><a href="https://rdrr.io/r/base/table.html" class="external-link">table()</a></code>) you can define a function, which can be iterated on all subsets.</p>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">collCount</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">collection_no</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">allGeo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tabinate.html">tabinate</a></span><span class="op">(</span><span class="va">corals</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, FUN<span class="op">=</span><span class="va">collCount</span><span class="op">)</span></span></code></pre></div>
<p>This is a somewhat slower solution, but its utility is evident when more complicated functions are passed to the iterator, such the <code>georanges()</code> presented before.</p>
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">allGeo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tabinate.html">tabinate</a></span><span class="op">(</span><span class="va">corals</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span>, </span>
<span>  FUN<span class="op">=</span><span class="va">georange</span>, lat<span class="op">=</span><span class="st">"paleolat"</span>, lng<span class="op">=</span><span class="st">"paleolng"</span>, method<span class="op">=</span><span class="st">"co"</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/tabinate.html">tabinate()</a></code> function currently accepts functions that output single values or vectors as output, but its applicability will be increased in the future.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h2>
<p>The development of the package began in the context of a project on global paleobiogeography funded by the Deutsche Forschungsgemeinschaft (DFG project numbers Ko 5382/1-1, Ko 5382/1-2, Ki 806/16-1). The package is also part of the DFG Research Unit 2332: TERSANE (TEmperature Related Stressors in ANcient Extinctions). We are thankful to all testers of the package including Emilia Jarochowska, Vanessa Roden, Andreas Lauchstedt, Gwen Antell and Roger Benson for suggestions, and all participants of the first year International Master’s Programme for Paleobiology at the GeoZentrum Nordbayern, FAU in Erlangen, Germany. We also thank all enterers of the Paleobiology Database.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Alroy, J. (2008). Dynamics of origination and extinction in the marine fossil record. Proceedings of the National Academy of Science, 105, 11536–11542.</p>
<p>Alroy, J., Marshall, C. R., Bambach, R. K., Bezusko, K., Foote, M., Fürsich, F. T., … Webber, A. (2001). Effects of sampling standardization on estimates of Phanerozoic marine diversification. Proceedings of the National Academy of Science, 98(11), 6261–6266. <a href="https://doi.org/10.1073/pnas.111144698" class="external-link uri">https://doi.org/10.1073/pnas.111144698</a></p>
<p>Alroy, J., Aberhan, M., Bottjer, D. J., Foote, M., Fürsich, F. T., Harries, P. J., … Visaggi, C. C. (2008). Phanerozoic Trends in the Global Diversity of Marine Invertebrates. Science, 321(5885), 97–100. <a href="https://doi.org/10.1126/science.1156963" class="external-link uri">https://doi.org/10.1126/science.1156963</a></p>
<p>Alroy, J. (2010). The Shifting Balance of Diversity Among Major Marine Animal Groups. Science, 329, 1191–1194. <a href="https://doi.org/10.1126/science.1189910" class="external-link uri">https://doi.org/10.1126/science.1189910</a></p>
<p>Alroy, J. (2010b). Geographical, environmental and intrinsic biotic controls on Phanerozoic marine diversification. Palaeontology 53:1211-1235.https://doi.org/10.1111/j.1475-4983.2010.01011.x</p>
<p>Alroy, J. (2014). Accurate and precise estimates of origination and extinction rates. Paleobiology, 40(3), 374–397. <a href="https://doi.org/10.1666/13036" class="external-link uri">https://doi.org/10.1666/13036</a></p>
<p>Alroy, J. (2015). A more precise speciation and extinction rate estimator. Paleobiology, 41(04), 633–639. <a href="https://doi.org/10.1017/pab.2015.26" class="external-link uri">https://doi.org/10.1017/pab.2015.26</a></p>
<p>Bell, M. A. (2015). geoscale: Geological Time Scale Plotting. R package version 2.0. Retrieved from <a href="http://CRAN.R-project.org/package=geoscale" class="external-link uri">http://CRAN.R-project.org/package=geoscale</a></p>
<p>Foote, M., &amp; Raup, D. M. (1996). Fossil Preservation and the Stratigraphic Ranges of Taxa. Paleobiology, 22(2), 121–140.</p>
<p>Chao, A., &amp; Jost, L. (2012). Coverage-based rarefaction and extrapolation: standardizing samples by completeness rather than size. Ecology, 93(12), 2533–2547. <a href="https://doi.org/10.1890/11-1952.1" class="external-link uri">https://doi.org/10.1890/11-1952.1</a></p>
<p>Foote, M. (1999). Morphological Diversity In The Evolutionary Radiation Of Paleozoic and Post-Paleozoic Crinoids. Paleobiology, 25(S2), 1–115.</p>
<p>Foote, M. (2000). Origination and Extinction Components of Taxonomic Diversity: General Problems. Paleobiology, 26(4), 74–102.</p>
<p>Foote, M. (2006). Substrate Affinity and Diversity Dynamics of Paleozoic Marine Animals. Paleobiology, 32(3), 345–366. <a href="https://doi.org/10.2307/4096955" class="external-link uri">https://doi.org/10.2307/4096955</a></p>
<p>Good, I. J. (1953). The Popoulation Frequencies of Species and the Estimation of Population Parameters. Biometrika, 40(3/4), 237–264.</p>
<p>Gradstein, F. M., Ogg, J. G., &amp; Schmitz, M. D. (2020). The geologic time scale 2020. Elsevier.</p>
<p>Kiessling, W., &amp; Aberhan, M. (2007). Environmental determinants of marine benthic biodiversity dynamics through Triassic-Jurassic time. Paleobiology, 33(3), 414–434.</p>
<p>Kiessling, W., &amp; Kocsis, A. T. (2015). Biodiversity dynamics and environmental occupancy of fossil azooxanthellate and zooxanthellate scleractinian corals. Paleobiology, 41(3), 402–414.</p>
<p>Kiessling, W., &amp; Simpson, C. (2011). On the potential for ocean acidification to be a general cause of ancient reef crises. Global Change Biology, 17, 56–67. <a href="https://doi.org/10.1111/j.1365-2486.2010.02204.x" class="external-link uri">https://doi.org/10.1111/j.1365-2486.2010.02204.x</a></p>
<p>Kocsis, A. T., Reddin, C. J., Alroy, J. and Kiessling, W. (2019). The R package divDyn for quantifying diversity dynamics using fossil sampling data. Methods in Ecology and Evolution. <a href="https://doi.org/10.1111/2041-210X.13161" class="external-link uri">https://doi.org/10.1111/2041-210X.13161</a></p>
<p>Raup, D. M. (1975). Taxonomic Diversity Estimation Using Rarefaction. Paleobiology, 1, 333–342. <a href="https://doi.org/10.2307/2400135" class="external-link uri">https://doi.org/10.2307/2400135</a></p>
<p>Raup, D. M. (1979). Biases in the fossil record of species and genera. Bulletin of the Carnegie Museum of Natural History, 13, 85-91.</p>
<p>Raup, D. M. (1985). Mathematical Models of Cladogenesis. Paleobiology, 11(1), 42–52.</p>
<p>Sepkoski Jr, J. J. (2002). A compendium of fossil marine animal genera. Bulletins of American Paleontology, 363, 1-560.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://palaeobiology.nat.fau.de/people/instructors/kocsis/" class="external-link">Adam T. Kocsis</a>, <a href="https://researchers.mq.edu.au/en/persons/john-alroy" class="external-link">John Alroy</a>, <a href="https://www.gzn.nat.fau.eu/palaeontologie/team/former-members/reddin/" class="external-link">Carl J. Reddin</a>, <a href="https://www.gzn.nat.fau.eu/palaeontologie/team/professors/kiessling/" class="external-link">Wolfgang Kiessling</a>, <a href="https://www.dfg.de/en/index.jsp" class="external-link"><img src="https://www.dfg.de/includes/bausteine/open_graph_de/dfgfallback.jpg" alt="dfg" width="80"></a>, <a href="https://www.gzn.nat.fau.eu/" class="external-link"><img src="https://www.gzn.nat.fau.de/files/2017/05/cropped-gzn-logo.jpg" alt="geozentrum" width="80"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
