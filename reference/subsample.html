<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="The function will take a function that has an occurrence dataset as an argument, and reruns it iteratively on the subsets of the dataset."><title>Subsampling wrapper function — subsample • divDyn</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Subsampling wrapper function — subsample"><meta property="og:description" content="The function will take a function that has an occurrence dataset as an argument, and reruns it iteratively on the subsets of the dataset."><meta property="og:image" content="https://divDyn.github.io/reference/figures/logo.png"><meta property="og:image:alt" content="The divDyn sticker."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@atkocsis"><meta name="twitter:site" content="@atkocsis"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">divDyn</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <a class="dropdown-item" href="../articles/divDyn_1_installation.html">1. Installation</a>
    <a class="dropdown-item" href="../articles/divDyn_2_handout.html">2. Handout</a>
  </div>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-internals">Internals</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-internals">
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://www.evolv-ed.net/">How-to guides on EvolvED</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/divDyn/divDyn/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Subsampling wrapper function</h1>
      <small class="dont-index">Source: <a href="https://github.com/divDyn/divDyn/blob/HEAD/R/subsample.R" class="external-link"><code>R/subsample.R</code></a></small>
      <div class="d-none name"><code>subsample.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The function will take a function that has an occurrence dataset as an argument, and reruns it iteratively on the subsets of the dataset.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">subsample</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  <span class="va">q</span>,</span>
<span>  tax <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  bin <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  FUN <span class="op">=</span> <span class="va">divDyn</span>,</span>
<span>  coll <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  iter <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"cr"</span>,</span>
<span>  keep <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  rem <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  duplicates <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  output <span class="op">=</span> <span class="st">"arit"</span>,</span>
<span>  useFailed <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  FUN.args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  na.rm <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  counter <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>x</dt>
<dd><p>(<code>data.frame</code>): Occurrence dataset, with <code>bin</code>, <code>tax</code> and <code>coll</code> as column names.</p></dd>


<dt>q</dt>
<dd><p>(<code>numeric)</code>: Subsampling level argument (mandatory). Depends on the subsampling function, it is the number of occurrences for <code>"cr"</code>, and the number of desired occurrences to the power of <code>xexp</code> for O^x^W. It is also the quorum of the SQS method.</p></dd>


<dt>tax</dt>
<dd><p>(<code>character</code>): The name of the taxon variable.</p></dd>


<dt>bin</dt>
<dd><p>(<code>character</code>): The name of the subsetting variable (has to be integer). For time series, this is the time-slice variable. Rows with <code>NA</code> entries in this column will be omitted.</p></dd>


<dt>FUN</dt>
<dd><p>(<code>function</code>): The function to be iteratively executed on the results of the subsampling trials. If set to <code>NULL</code>, no function will be executed, and the subsampled datasets will be returned as a <code>list</code>. By default set to the <code><a href="divDyn.html">divDyn</a></code> function. The function must have an argument called <code>x</code>, that represents the dataset resulting from a subsampling trial (or the entire dataset). Arguments of the <code>subsample</code> function call will be searched for potential arguments of this function, which means that already provided variables (e.g. <code>bin</code> and <code>tax</code>) will also be used. You can also provide additional arguments (similarly to the <code><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></code> iterator). Functions that allow arguments to pass through (that have argument '...') are not allowed, as well as functions that have the same arguments as <code>subsample</code> but would require different values.</p></dd>


<dt>coll</dt>
<dd><p>(<code>character</code>): The variable name of the collection identifiers.</p></dd>


<dt>iter</dt>
<dd><p>(<code>numeric</code>): The number of iterations to be executed.</p></dd>


<dt>type</dt>
<dd><p>(<code>character</code>): The type of subsampling to be implemented. By default this is classical rarefaction (<code>"cr"</code>). (<code>"oxw"</code>) stands for occurrence weighted by-list subsampling. If set to (<code>"sqs"</code>), the program will execute the shareholder quorum subsampling algorithm as it was suggested by Alroy (2010). Setting the argument to <code>"none"</code> will invoke no subsamling, but the applied function will be iterated on the trials, nevertheless.</p></dd>


<dt>keep</dt>
<dd><p>(<code>numeric</code>): The bins, which will not be subsampled but will be added to the subsampling trials. NIf the number of occurrences does not reach the subsampling quota, by default it will not be represented in the subsampling trials. You can force their inclusion with the <code>keep</code> argument separetely (for all, see the <code>useFailed</code> argument).</p></dd>


<dt>rem</dt>
<dd><p>(<code>numeric</code>): The bins, which will be removed from the dataset before the subsampling trials.</p></dd>


<dt>duplicates</dt>
<dd><p>(<code>logical</code> ): Toggles whether multiple entries from the same taxon (<code>"tax"</code>) and collection (<code>"coll"</code>) variables should be omitted. Useful for omitting occurrences of multiple species-level occurrences of the same genus. By default these are allowed through analyses (<code>duplicates=TRUE</code>), setting this to <code>FALSE</code> will require you to provide a collection variable. (<code>coll</code>)</p></dd>


<dt>output</dt>
<dd><p>(<code>character</code>): If the function output are vectors or matrices, the <code>"arit"</code> and <code>"geom"</code> values will trigger simple averaging with arithmetic or geometric means. If the function output of a single trial is again a <code>vector</code> or a <code>matrix</code>, setting the output to <code>"dist"</code> will return the calculated results of every trial, organized in a <code>list</code> of independent variables (e.g. if the function output is value, the return will contain a single <code>vector</code>, if it is a <code>vector</code>, the output will be a list of <code>vector</code>s, if the function output is a <code>data.frame</code>, the output will be a <code>list</code> of <code>matrix</code> class objects). If <code>output="list"</code>, the structure of the original function output will be retained, and the results of the individual trials will be concatenated to a <code>list</code>.</p></dd>


<dt>useFailed</dt>
<dd><p>(<code>logical</code>): If the bin does not reach the subsampling quota, should the bin be used?</p></dd>


<dt>FUN.args</dt>
<dd><p>(<code>list</code>): Arguments passed to the applied function <code>FUN</code> but not used by the subsampling wrapper. Normally, the arguments of <code>FUN</code> can be added to the call of <code>subsample</code>, but in case you want to use different values for the same argument, then the arguments added here will be used for the call of <code>FUN</code>. For instance, if you want to call <code>subsample</code> with <code>bin=NULL</code>, but want to run <code>FUN=divDyn</code> with a valid <code>bin</code> column then you can add the column name here, e.g. <code>FUN.args=list(bin="stg")</code>.</p></dd>


<dt>na.rm</dt>
<dd><p>(<code>logical</code>): The function call includes more column names that might contain missing values. If this flag is set to <code>TRUE</code>, all rows will be dropped that have missig values in the specificed columns. This might lead to the exclusion of some data you do not want to exclude.</p></dd>


<dt>counter</dt>
<dd><p>(<code>logical</code>): Should the loop counting be visible?</p></dd>


<dt>...</dt>
<dd><p>arguments passed to <code>FUN</code> and the type-specific subsampling functions: <code><a href="subtrial.html">subtrialCR</a></code>, <code><a href="subtrial.html">subtrialOXW</a></code>, <code><a href="subtrial.html">subtrialSQS</a></code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Either a list of replicates or an object matching the class of <code>FUN</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>subsample</code> function implements the iterative framework of the sampling standardization procedure. 
The function 1. takes the dataset <code>x</code>, 2. runs function <code>FUN</code> on the dataset and creates a container for results of trials
3. runs one of the subsampling trial functions (e.g. <code><a href="subtrial.html">subtrialCR</a></code>) to get a subsampled 'trial dataset'
4. runs <code>FUN</code> on the trial dataset and
5. averages the results of the trials for a simple output of step 4. such as <code>vector</code>s, <code>matrices</code> and <code>data.frames</code>. For averaging, the <code>vectors</code> and <code>matrices</code> have to have the same output dimensions in the subsampling, as in the original object. For <code>data.frames</code>, the bin-specific information have to be in rows and the <code>bin</code> numbers have to be given in a variable <code>bin</code> in the output of <code>FUN</code>.
For a detailed treatment on what the function does, please see the vignette ('Handout to the R package 'divDyn' v0.5.0 for diversity dynamics from fossil occurrence data'). Currently the Classical Rarefaction (<code>"cr"</code>, Raup, 1975), the occurrence weighted by-list subsampling (<code>"oxw"</code>, Alroy et al., 2001) and the Shareholder Quorum Subsampling methods are implemented (<code>"sqs"</code>, Alroy, 2010).</p>
<p><strong>References:</strong></p>
<p>Alroy, J., Marshall, C. R., Bambach, R. K., Bezusko, K., Foote, M., Fürsich, F. T., … Webber, A. (2001). Effects of sampling standardization on estimates of Phanerozoic marine diversification. Proceedings of the National Academy of Science, 98(11), 6261-6266.</p>
<p>Alroy, J. (2010). The Shifting Balance of Diversity Among Major Marine Animal Groups. Science, 329, 1191-1194. https://doi.org/10.1126/science.1189910</p>
<p>Raup, D. M. (1975). Taxonomic Diversity Estimation Using Rarefaction. Paleobiology, 1, 333-342. https: //doi.org/10.2307/2400135</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">corals</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">stages</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Example 1-calculate metrics of diversity dynamics</span></span></span>
<span class="r-in"><span>  <span class="va">dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="divDyn.html">divDyn</a></span><span class="op">(</span><span class="va">corals</span>, tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">rarefDD</span><span class="op">&lt;-</span><span class="fu">subsample</span><span class="op">(</span><span class="va">corals</span>,iter<span class="op">=</span><span class="fl">30</span>, q<span class="op">=</span><span class="fl">50</span>,</span></span>
<span class="r-in"><span>  tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span>, output<span class="op">=</span><span class="st">"dist"</span>, keep<span class="op">=</span><span class="fl">95</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 </span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="co"># plotting</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">260</span>,<span class="fl">0</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>  ylab<span class="op">=</span><span class="st">"range-through diversity (genera)"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">230</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span>, <span class="va">dd</span><span class="op">$</span><span class="va">divRT</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="shades.html">shades</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span>, <span class="va">rarefDD</span><span class="op">$</span><span class="va">divRT</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"raw"</span>,<span class="st">"rarefaction"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"black"</span>, <span class="st">"blue"</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="subsample-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Example 2-SIB diversity </span></span></span>
<span class="r-in"><span><span class="co"># draft a simple function to calculate SIB diversity</span></span></span>
<span class="r-in"><span><span class="va">sib</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">bin</span>, <span class="va">tax</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">calc</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span>INDEX<span class="op">=</span><span class="va">x</span><span class="op">[</span>,<span class="va">bin</span><span class="op">]</span>, X<span class="op">=</span><span class="va">x</span><span class="op">[</span>,<span class="va">tax</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">calc</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">stg</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">sibDiv</span><span class="op">&lt;-</span><span class="fu">sib</span><span class="op">(</span><span class="va">corals</span>, bin<span class="op">=</span><span class="st">"stg"</span>, tax<span class="op">=</span><span class="st">"genus"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># calculate it with subsampling</span></span></span>
<span class="r-in"><span><span class="va">rarefSIB</span><span class="op">&lt;-</span><span class="fu">subsample</span><span class="op">(</span><span class="va">corals</span>,iter<span class="op">=</span><span class="fl">25</span>, q<span class="op">=</span><span class="fl">50</span>,</span></span>
<span class="r-in"><span>  tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span>, output<span class="op">=</span><span class="st">"arit"</span>, keep<span class="op">=</span><span class="fl">95</span>, FUN<span class="op">=</span><span class="va">sib</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 </span>
<span class="r-in"><span><span class="va">rarefDD</span><span class="op">&lt;-</span><span class="fu">subsample</span><span class="op">(</span><span class="va">corals</span>,iter<span class="op">=</span><span class="fl">25</span>, q<span class="op">=</span><span class="fl">50</span>,</span></span>
<span class="r-in"><span>  tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span>, output<span class="op">=</span><span class="st">"arit"</span>, keep<span class="op">=</span><span class="fl">95</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot</span></span></span>
<span class="r-in"><span><span class="fu"><a href="tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">260</span>,<span class="fl">0</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>  ylab<span class="op">=</span><span class="st">"SIB diversity (genera)"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">230</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span>, <span class="va">rarefDD</span><span class="op">$</span><span class="va">divSIB</span>, lwd<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span>, <span class="va">rarefSIB</span>, lwd<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="subsample-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Example 3 - different subsampling types with default function (divDyn)</span></span></span>
<span class="r-in"><span><span class="co"># compare different subsampling types</span></span></span>
<span class="r-in"><span>  <span class="co"># classical rarefaction</span></span></span>
<span class="r-in"><span>  <span class="va">cr</span><span class="op">&lt;-</span><span class="fu">subsample</span><span class="op">(</span><span class="va">corals</span>,iter<span class="op">=</span><span class="fl">25</span>, q<span class="op">=</span><span class="fl">20</span>,tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span>, output<span class="op">=</span><span class="st">"dist"</span>, keep<span class="op">=</span><span class="fl">95</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 </span>
<span class="r-in"><span>  <span class="co"># by-list subsampling (unweighted) - 3 collections</span></span></span>
<span class="r-in"><span>  <span class="va">UW</span><span class="op">&lt;-</span><span class="fu">subsample</span><span class="op">(</span><span class="va">corals</span>,iter<span class="op">=</span><span class="fl">25</span>, q<span class="op">=</span><span class="fl">3</span>,tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span>, coll<span class="op">=</span><span class="st">"collection_no"</span>, </span></span>
<span class="r-in"><span>    output<span class="op">=</span><span class="st">"dist"</span>, keep<span class="op">=</span><span class="fl">95</span>, type<span class="op">=</span><span class="st">"oxw"</span>, xexp<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 </span>
<span class="r-in"><span>  <span class="co"># occurrence weighted by list subsampling</span></span></span>
<span class="r-in"><span>  <span class="va">OW</span><span class="op">&lt;-</span><span class="fu">subsample</span><span class="op">(</span><span class="va">corals</span>,iter<span class="op">=</span><span class="fl">25</span>, q<span class="op">=</span><span class="fl">20</span>,tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span>, coll<span class="op">=</span><span class="st">"collection_no"</span>, </span></span>
<span class="r-in"><span>    output<span class="op">=</span><span class="st">"dist"</span>, keep<span class="op">=</span><span class="fl">95</span>, type<span class="op">=</span><span class="st">"oxw"</span>, xexp<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 </span>
<span class="r-in"><span> </span></span>
<span class="r-in"><span>  <span class="va">SQS</span><span class="op">&lt;-</span><span class="fu">subsample</span><span class="op">(</span><span class="va">corals</span>,iter<span class="op">=</span><span class="fl">25</span>, q<span class="op">=</span><span class="fl">0.4</span>,tax<span class="op">=</span><span class="st">"genus"</span>, bin<span class="op">=</span><span class="st">"stg"</span>, output<span class="op">=</span><span class="st">"dist"</span>, keep<span class="op">=</span><span class="fl">95</span>, type<span class="op">=</span><span class="st">"sqs"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># plot</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="tsplot.html">tsplot</a></span><span class="op">(</span><span class="va">stages</span>, shading<span class="op">=</span><span class="st">"series"</span>, boxes<span class="op">=</span><span class="st">"sys"</span>, xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">260</span>,<span class="fl">0</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>  ylab<span class="op">=</span><span class="st">"range-through diversity (genera)"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="shades.html">shades</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span>, <span class="va">cr</span><span class="op">$</span><span class="va">divRT</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="shades.html">shades</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span>, <span class="va">UW</span><span class="op">$</span><span class="va">divRT</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="shades.html">shades</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span>, <span class="va">OW</span><span class="op">$</span><span class="va">divRT</span>, col<span class="op">=</span><span class="st">"green"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="shades.html">shades</a></span><span class="op">(</span><span class="va">stages</span><span class="op">$</span><span class="va">mid</span>, <span class="va">SQS</span><span class="op">$</span><span class="va">divRT</span>, col<span class="op">=</span><span class="st">"cyan"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, bg<span class="op">=</span><span class="st">"white"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CR (20)"</span>, <span class="st">"UW (3)"</span>, <span class="st">"OW (20)"</span>, <span class="st">"SQS (0.4)"</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>    col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"cyan"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="subsample-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://palaeobiology.nat.fau.de/people/instructors/kocsis/" class="external-link">Adam T. Kocsis</a>, <a href="https://researchers.mq.edu.au/en/persons/john-alroy" class="external-link">John Alroy</a>, <a href="https://www.gzn.nat.fau.eu/palaeontologie/team/former-members/reddin/" class="external-link">Carl J. Reddin</a>, <a href="https://www.gzn.nat.fau.eu/palaeontologie/team/professors/kiessling/" class="external-link">Wolfgang Kiessling</a>, <a href="https://www.dfg.de/en/index.jsp" class="external-link"><img src="https://www.dfg.de/includes/bausteine/open_graph_de/dfgfallback.jpg" alt="dfg" width="80"></a>, <a href="https://www.gzn.nat.fau.eu/" class="external-link"><img src="https://www.gzn.nat.fau.de/files/2017/05/cropped-gzn-logo.jpg" alt="geozentrum" width="80"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

